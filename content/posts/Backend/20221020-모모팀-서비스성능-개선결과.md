---
title: "λ¨λ¨ν€ μ„λΉ„μ¤ μ„±λ¥ κ°μ„  κ²°κ³Ό (μ„±λ¥ ν…μ¤νΈ)"
date: 2022-10-20
tags: ["SpringFramework", "μ„±λ¥ κ°μ„ κΈ°", "μ„±λ¥ ν…μ¤νΈ", "JMeter", "λ¨λ‹ν„°λ§", "Prometheus", "Grafana"]
draft: false
---
# 1. λ“¤μ–΄κ°€λ©°

λ¨λ¨ν€ μ„λΉ„μ¤μ κΈ°λ¥ κ°λ°μ„ 1μ°¨μ μΌλ΅ λ§λ¬΄λ¦¬ν• ν›„, μμ΅΄κ΄€κ³„μ™€ μ„±λ¥ κ°μ„ μ„ μ§„ν–‰ν•κ² λμ—λ‹¤. μ΄λ² ν¬μ¤νΈμ—μ„λ” 3μ°¨λ΅€μ— κ±ΈμΉ μ„λΉ„μ¤ μ„±λ¥ κ°μ„  μ‘μ—… μ „/ν›„λ΅ μ„±λ¥μ΄ μ–Όλ§λ‚ ν–¥μƒλμ—λ”μ§€ λΉ„κµν•΄λ³΄λ ¤ν•λ‹¤.

> μ•μ„ μ§„ν–‰ν• μμ΅΄κ΄€κ³„ κ°μ„ κ³Ό μΏΌλ¦¬ κ°μ„  κ³Όμ •μ„ μμ„Έν ν™•μΈν•κ³  μ‹¶λ‹¤λ©΄ μ•„λμ ν¬μ¤νΈλ¥Ό ν™•μΈν•κΈΈ λ°”λ€λ‹¤.
>
>
> [λ¨λ¨ν€ μ„λΉ„μ¤ μ„±λ¥ κ°μ„ κΈ°1 (μμ΅΄κ΄€κ³„ κ°μ„ )](https://seongwon.dev/Spring/20221009-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B01/)
>
> [λ¨λ¨ν€ μ„λΉ„μ¤ μ„±λ¥ κ°μ„ κΈ°2 (μ΅°ν μΏΌλ¦¬ κ°μ„ )](https://seongwon.dev/Spring/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/)
>
> [λ¨λ¨ν€ μ„λΉ„μ¤ μ„±λ¥ κ°μ„ κΈ°3 (CUD μΏΌλ¦¬ κ°μ„ )](https://seongwon.dev/Spring/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/)
>

# 2. ν…μ¤νΈ ν™κ²½ μ„Έν…

## 2.1. λ¶€ν• ν…μ¤νΈ ν΄

μ„±λ¥ ν…μ¤νΈ ν΄μ€ λ€ν‘μ μΌλ΅ Apacheμ—μ„ κ°λ°ν• JMeterμ™€ Naverμ—μ„ κ°λ°ν• NGrinderκ°€ μ΅΄μ¬ν•λ‹¤. μ²μμ—λ” NGrinderμ κ²½μ° EC2μ— μ»¨νΈλ΅¤λ¬μ™€ μ—μ΄μ „νΈλ¥Ό λ¶„λ¦¬ν•μ—¬ κ°κ° μ¬λ ¤μ„ ν…μ¤νΈλ¥Ό ν•λ ¤κ³  ν•μ€μΌλ‚ μ κ³µλ°›μ€ EC2μ λ³΄μ• μΈλ°”μ΄λ“ κ·μΉ™μ— μν•΄ μ»¨νΈλ΅¤λ¬μ™€ μ—μ΄μ „νΈλ¥Ό λ¶„λ¦¬ν•μ—¬ μ‚¬μ©ν•  μκ°€ μ—†μ—λ‹¤. λν• λ΅μ»¬ PCμ— μ„¤μΉν•μ—¬ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•λ ¤κ³  ν•μ—¬λ„ M1 Pro μΉ© κ΄€λ ¨ νΈν™μ„± μ΄μκ°€ μμ–΄ ν…μ¤νΈ μ¤ν¬λ¦½νΈ μ»΄νμΌμ΄ λ¶κ°€λ¥ν•΄ μ‚¬μ©ν•μ§€ λ»ν•μ€λ‹¤. κ²°κµ­ NGrinderλ” λ’¤λ΅ν•κ³  **λ¨λ¨ν€μ€ ν…μ¤νΈ ν΄λ΅ JMeterλ¥Ό μ‚¬μ©ν•κ² λμ—λ‹¤.**

## 2.2. λ¨λ‹ν„°λ§ ν΄

JMeterλ΅ μ„±λ¥ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•μ—¬λ„ ν…μ¤νΈ κ²°κ³Όμ— λ€ν• μ§€ν‘λ¥Ό ν™•μΈν•  μ μλ‹¤. ν•μ§€λ§ Response Time, TPSλ“±μ μ μ€ μ–‘μ μ •λ³΄λ§μ„ μ κ³µλ°›μ„ μ μκΈ°μ— μ¶”κ°€μ μΌλ΅ **Prometheus**, **Grafana**λ¥Ό μ΄μ©ν• λ¨λ‹ν„°λ§ ν™κ²½μ„ κµ¬μ¶•ν•μ€λ‹¤.

> **Prometheusλ€?**
>
> - Prometheusλ” μ¤ν”μ†μ¤ μ‹μ¤ν… λ¨λ‹ν„°λ§ ν΄ν‚·μ΄λ‹¤. λ¨λ‹ν„°λ§μ„ ν•  μ„λ²„μ— exporterλ¥Ό μ„¤μΉν•΄ λ§¤νΈλ¦­μ„ μμ§‘ν•κ³  HTTP ν†µμ‹ μ„ ν†µν•΄ μ—”λ“ν¬μΈνΈλ¥Ό μ κ³µν•λ©΄ Prometheusλ” ν•΄λ‹Ή μ •λ³΄λ¥Ό μμ§‘ν•  μ μλ‹¤.
>
> **Grafanaλ€?**
>
> - Grafanaλ” λ©”νΈλ¦­ λ°μ΄ν„° μ‹κ°ν™” λ„κµ¬μ΄λ‹¤. ν•΄λ‹Ή ν΄μ„ μ‚¬μ©ν•λ©΄ Prometheusμ—μ„ μμ§‘ν• μ •λ³΄λ¥Ό λ³΄κΈ° μ‰½κ² μ‹κ°ν™”ν•΄μ¤€λ‹¤.
>

> λ” μμ„Έν• μ •λ³΄λ¥Ό μ–»κ³  μ‹¶λ‹¤λ©΄ μ•„λμ λ§ν¬λ¥Ό μ°Έκ³ ν•κΈΈ λ°”λ€λ‹¤.
> - [Prometheusλ€?](https://medium.com/finda-tech/prometheus%EB%9E%80-cf52c9a8785f)
> - [κ·ΈλΌνλ‚(Grafana)λ€?](https://www.44bits.io/ko/keyword/grafana)
>

ν™κ²½μ„ κµ¬μ¶•ν• κ²°κ³Ό μ•„λμ™€ κ°™μ΄ CPU, HikariCPμ DB μ»¤λ„¥μ…, λ©”λ¨λ¦¬, GCμ‚¬μ©λ‰ λ“± μ—¬λ¬ μ •λ³΄λ¥Ό λ³µν•©μ μΌλ΅ λ¨λ‹ν„°λ§ ν•  μ μκ² λμ—λ‹¤.

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img.png)

# 3. ν…μ¤νΈ κµ¬μ΅°

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_1.png)

ν…μ¤νΈ κµ¬μ΅°λ” μ„μ™€ κ°™λ‹¤. λ΅μ»¬μ—μ„ JMeterλ΅ μ°λ¦¬ μ„λΉ„μ¤μ λ©ν‘ μΈμ›μΈ 100λ…μ—μ„ 150λ…μ΄ κ°κ° 4λ¶„λ™μ• μ§€μ†μ μΌλ΅ μ „μ²΄ νμ΄μ§€ μ΅°ν APIμ™€ μƒμ„Έ νμ΄μ§€ μ΅°ν APIλ¥Ό νΈμ¶ν•λ„λ΅ ν•λ©° λ¶€ν•λ¥Ό μ¤¬λ‹¤.

λ¶€ν•λ¥Ό μ¤€ λ¨λ‹ν„°λ§ EC2μ—μ„λ” Prometheusκ°€ WASμ„λ²„μ—μ„ λ³΄λ‚΄μ£Όλ” μ •λ³΄λ¥Ό λ¨μΌκ³  Grafanaκ°€ ν•΄λ‹Ή μ •λ³΄λ¥Ό μ‹κ°ν™”ν•΄μ£Όλ” κµ¬μ΅°λ΅ λ§λ“¤μ—λ‹¤.

> μ‹¤μ  μ„λΉ„μ¤ κµ¬μ΅°λ€λ΅ NGINX μ›Ή μ„λ²„λ¥Ό κ±°μΉ μ΄ν›„μ— WASλ΅ μ”μ²­μ΄ κ°„λ‹¤. ν…μ¤νΈμ—μ„λ” WASλ§μ μ„±λ¥ κ°μ„  μ „/ν›„λ¥Ό λΉ„κµν•κΈ° μ„ν•΄ μµλ€ν• μ™Έλ¶€μ μν–¥μ„ μ¤„μ΄κΈ° μ„ν•΄μ„ WASλ΅ λ°”λ΅ μ”μ²­μ„ λ³΄λƒλ‹¤.
>

> κ°κ°μ EC2μ •λ³΄λ” μ•„λμ™€ κ°™λ‹¤.
>
> - t4g.micro
> - CPU: 2 Core
> - RAM: 1 GB
> - Memory: 8GB

# 4. ν…μ¤νΈ κ²°κ³Ό

## 4.1. Throughput

- κ°μ„  μ „, 150λ…μ΄ μ§€μ†μ μΌλ΅ 2λ¶„ 30μ΄λ™μ• μ”μ²­ν• κ²°κ³Ό
   ![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_2.png)

- κ°μ„  ν›„, 150λ…μ΄ μ§€μ†μ μΌλ΅ 2λ¶„30μ΄λ™μ• μ”μ²­ν• κ²°κ³Ό
   ![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_3.png)

κ°μ„  μ „/ν›„λ΅ JMeterλ¥Ό ν†µν•΄ 150λ…μ΄ 2λ¶„ 30μ΄λ™μ• μ§€μ†μ μΌλ΅ μ”μ²­μ„ λ³΄λ‚Έ κ²°κ³Όλ” μ„μ™€ κ°™λ‹¤. ν•΄λ‹Ή Throughput ν‘λ¥Ό μ‚΄ν΄λ³΄λ©΄ **μ΄λ‹Ή μ²λ¦¬λ‰μ΄ 2.6λ°°λ΅ ν–¥μƒ**λ κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

## 4.2. TPS

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_4.png)

> TPSλ” Transaction Per Secondμ μ•½μλ΅ μ΄λ‹Ή μ΄λ‹Ή request / responseκ°€ μν–‰λ μ–‘μ„ λ»ν•λ‹¤.
>
>
> π“Β μ—¬κΈ°μ„ transactionμ΄λ€ ν•λ‚μ HTTP request / response μμ„ μλ―Έν•λ‹¤.
>

150λ…μ μ”μ²­μ„ κΈ°μ¤€μΌλ΅ TPSμ μμΉλ¥Ό λΉ„κµν•΄λ³΄λ©΄ ν‰κ·  300μ—μ„ 570μΌλ΅ **μ•½ 90%μ •λ„ μ²λ¦¬λ‰μ΄ μ¦κ°€**ν• κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

## 4.3. Response Time

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_5.png)

Response Timeμ κ²°κ³Όλ¥Ό λΉ„κµν•΄λ΄¤μ„ λ•λ„ κ°μ„  μ „/ν›„λ¥Ό λΉ„κµν•μ€μ„ λ• μ‘λ‹µ μ‹κ°„μ΄ μ¤„μ–΄λ“  κ²ƒμ„ ν™•μΈν•  μ μμ—λ‹¤.

> μ¶λ ¥λ ν‘μ—μ„ κ·Έλν”„μ yμ¶• λ²”μ„κ°€ λ„λ¬΄ ν¬κ² λ‚μ™€ μ‘λ‹µμ‹κ°„μ μμΉλ¥Ό μ¶”μ¶ν•κΈ° μ–΄λ ¤μ› μμΉμƒμ λΉ„κµλ” μƒλµν•μ€λ‹¤.
>

## 4.4. CPU μ‚¬μ©λ‰

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_6.png)

CPU μ‚¬μ©λ‰μ€ μ‚¬μ©μ¤‘μΈ EC2μ μ½”μ–΄κ°€ 2κ°λΏμ΄λΌ μ‚¬μ©λ‰μ— λ€ν•΄μ„λ” ν° μ°¨μ΄κ°€ μ—†λ‹¤. ν•μ§€λ§ μ΄λ―Έμ§€λ¥Ό λ³΄λ©΄ μ• μ μλ“―μ΄ μ‚¬μ©λ‰μ΄ μ΅°κΈμ€ μ¤„μ–΄λ“  κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

## 4.5. Memory Allocation

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_7.png)

λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ€ κ°μ„ /μ „ ν›„λ¥Ό λΉ„κµν•μ€μ„ λ• ν¬κ² κ°μ†ν• κ²ƒμ„ ν™•μΈν•  μ μμ—λ‹¤. κΈ°μ΅΄ μ΅°νλ΅μ§ κ°μ„ μ„ ν•μ§€ μ•μ•μ„ λ•λ” λ¨μ„ λ©λ΅ μ΅°νλ¥Ό ν•  λ•, DTOκ°€ μ•„λ‹ μλ§μ€ μ‹¤μ  κ°μ²΄λ“¤μ„ λ§λ“¤μ—λ‹¤. ν•΄λ‹Ή λ΅μ§λ“¤μ„ κ°μ„ ν•κ³  Repository λ μ΄μ–΄μ—μ„ μ‹¤μ  κ°μ²΄κ°€ μ•„λ‹ DTOλ¥Ό μ§μ ‘ λ°ν™ν•μ—¬ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ΄ **150λ… μ”μ²­μ„ κΈ°μ¤€μΌλ΅ μ•½ 44% κ°μ†**ν•μ€λ‹¤.

## 4.6. GC

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_8.png)

μΏΌλ¦¬ κ°μ„  μ΄ν›„,  μ΅°νλ¥Ό μ²λ¦¬ν•κΈ° μ„ν•΄ μƒμ„±ν•λ” ν΄λμ¤κ°€ μ¤„μ–΄λ“¤μ–΄ λ©”λ¨λ¦¬ μ‚¬μ©λ‰λΏλ§ μ•„λ‹λΌ GCλ¥Ό μ‚΄ν΄λ΄¤μ„ λ•λ„ μ„±λ¥ ν–¥μƒμ„ λλ‚„ μ μμ—λ‹¤. GC Countμ™€ GC stop μ‹κ°„μ„ μ‚΄ν΄λ΄¤μ„ λ• ν™•μ‹¤ν μ„±λ¥ κ°μ„  μ „/ν›„λ¥Ό λΉ„κµν•μ€μ„ λ• λ§μ€ κ°μ„ μ΄ μλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

## 4.7. DB Connection Pool (HikariCP)

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_9.png)

DB ConnectionPoolμΈ HikariCP λ¨λ‹ν„°λ§ κ²°κ³Όλ¥Ό λΉ„κµν•΄λ³΄λ©΄ κ°μ„  μ „/ν›„μ DB μ»¤λ„¥μ…ν’€ μ‚¬μ©μ„ λ€κΈ°ν•λ” μκ°€ ν¬κ² μ¤„μ–΄λ“  κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. ν•΄λ‹Ή κ²°κ³Όλ” μΏΌλ¦¬ κ°μ„  μ „μ—λ” μ§€μ—°λ΅λ”©κ³Ό N+1λ¬Έμ λ΅ μΈν• μΏΌλ¦¬ λ“±μΌλ΅ μλ§μ€ μΏΌλ¦¬λ“¤μ΄ μ‹¤ν–‰λμ—λ”λ° μΏΌλ¦¬ κ°μ„ μ„ ν•λ©° ν•„μ”ν• μµμ†ν•μ μΏΌλ¦¬κ°€ μ‹¤ν–‰λλ„λ΅ κ°μ„ ν•μ—¬ Connection Poolμ Pendingμ΄ ν¬κ² μ¤„μ–΄λ“¤μ—λ‹¤. 150λ… μ”μ²­μ„ κΈ°μ¤€μΌλ΅ λΉ„κµν•μ€μ„ λ• **μ»¤λ„¥μ… λ€κΈ° μµλ€μΉκ°€ μ•½ 49% κ°μ†**ν•μ€λ‹¤.

## 4.8. Requests/second

![Untitled](image/20221020-λ¨λ¨ν€-μ„λΉ„μ¤μ„±λ¥-κ°μ„ κ²°κ³Ό/img_10.png)

Requests/second λ°μ΄ν„°λ” μ΄λ‹Ή WASμ—μ„ μ²λ¦¬ν• Requestμ–‘μ„ μλ―Έν•λ‹¤. ν•΄λ‹Ή λ°μ΄ν„°μ μμΉλ¥Ό λΉ„κµν•λ©΄ κ°μ„  μ „μ—λ” μ΄λ‹Ή μ•½ 620κ°μ μ”μ²­μ„ μ²λ¦¬ν•μ€μΌλ©° κ°μ„  ν›„μ—λ” μ•½ 1150κ°μ μ”μ²­μ„ μ²λ¦¬ν•μ€λ‹¤. μ΄λ¥Ό μ„±λ¥ κ°μ„  μμΉλ΅ λΉ„κµν•λ©΄ **μ΄λ‹Ή μ•½ 85% λ” λ§μ€ μ”μ²­μ„ μ²λ¦¬ν•  μ μκ² λμ—λ‹¤.**

# 5. κ²°λ΅ 

μ§€λ‚ λ¨λ¨ν€ μΏΌλ¦¬ μ„±λ¥ κ°μ„ μ„ μ§„ν–‰ν• ν›„, μ΅°ν μΏΌλ¦¬μ— ν•ν•΄μ„ μ„±λ¥ λΉ„κµλ¥Ό μ§„ν–‰ν•΄λ΄¤λ‹¤. λ¨μ„ λ©λ΅ μ΅°ν, λ¨μ„ λ‹¨κ±΄ μ΅°νμ μΏΌλ¦¬λ¥Ό ν• μ„ΈνΈλ΅ 100λ…/150λ…μ μ μ €κ°€ μ§€μ†μ μΌλ΅ μ”μ²­μ„ λ‚ λ¦¬λ„λ΅ λ¶€ν•λ¥Ό μ£Όλ©° ν…μ¤νΈλ¥Ό ν•΄λ³Έ κ²°κ³Ό DB connection, λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ“± **μμ›μ μ‚¬μ©λ‰μ€ μ•½ 45% μ •λ„ κ°μ†**ν•μ€μΌλ©° **μ”μ²­ μ²λ¦¬μ— λ€ν•΄μ„λ” μ•½ 90% μ •λ„ μ„±λ¥μ΄ ν–¥μƒ**ν• κ²ƒμ„ ν™•μΈν•μ€λ‹¤.

λ¨μ„ μƒμ„±, μμ •, μ‚­μ μ— λ€ν• CUDμ‘μ—…μ— λ€ν•΄μ„λ” μ§μ ‘ μ§„ν–‰ν•μ§€ μ•μ•μ§€λ§ κ°μ„ λ CUD μΏΌλ¦¬μ μ „, ν›„λ¥Ό λΉ„κµν•μ€μ„ λ• μ΅°ν μΏΌλ¦¬λ³΄λ‹¤ λ”μ± ν° κ°μ„ μ΄ λμ—μ„ κ²ƒμ΄λΌ μƒκ°λλ‹¤.
