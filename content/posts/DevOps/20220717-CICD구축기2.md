---
title: "Jenkinsë¥¼ í†µí•œ CI/CD êµ¬ì¶•ê¸° 2í¸ (Backend CI/CD êµ¬ì¶•)"
date: 2022-07-17
tags: ["DevOps", "CI/CD", "Jenkins", "AWS", "EC2", "Spring"]
draft: false
---

> í•´ë‹¹ í¬ìŠ¤íŠ¸ëŠ” ëª¨ëª¨íŒ€ í¬ë£¨ [ë ‰ìŠ¤](https://github.com/Seongwon97)ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ì „ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì  í‚¨ìŠ¤ì˜ ì„¤ì¹˜ì— ëŒ€í•´ ë‹¤ë£¨ì–´ ë´¤ë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë³¸ê²©ì ìœ¼ë¡œ ì  í‚¨ìŠ¤ë¥¼ í†µí•œ CI/CD êµ¬ì¶• ê³¼ì •ì„ ë‹¤ë¤„ë³´ë ¤ê³  í•œë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img.png)

íŒ€ì—ì„œ êµ¬ì¶•í•˜ê³ ì í•˜ëŠ” CI/CD êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. í˜„ì¬ í¬ìŠ¤íŠ¸ì—ì„œëŠ” 5ë²ˆ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ê³¼ì •ì„ ì œì™¸í•œ 1ë²ˆì—ì„œë¶€í„° 6ë²ˆê¹Œì§€ì˜ êµ¬ì¶• ê³¼ì •ì„ ë‹´ì•„ë³´ì•˜ë‹¤.

# Jenkinsì˜ Item

ì  í‚¨ìŠ¤ì—ì„œ í•˜ë‚˜ì˜ CI/CD í”„ë¡œì íŠ¸ë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ì´í…œ(Item)ì„ ìƒì„±í•˜ì—¬ì•¼ í•œë‹¤. í•˜ë‚˜ì˜ ì  í‚¨ìŠ¤ ì„œë²„ì— ì—¬ëŸ¬ê°œì˜ ì•„ì´í…œì„ ë§Œë“¤ ìˆ˜ ìˆê³  ê°ê°ì˜ ì•„ì´í…œë“¤ì€ ê°œë°œìê°€ ì„¤ì •í•˜ëŠ” ê²ƒì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤. ì  í‚¨ìŠ¤ì—ì„œ ì•„ì´í…œì„ ë§Œë“œëŠ” ë°©ë²•ì€ ëŒ€í‘œì ìœ¼ë¡œ FreeStyleê³¼ Pipelineì´ ì¡´ì¬í•œë‹¤. ê³¼ê±°ì—ëŠ” Freestyle ë°©ë²•ì„ ë§ì´ ì‚¬ìš©í•˜ì˜€ë‹¤ê³  í•œë‹¤. í•˜ì§€ë§Œ ìš”ì¦˜ì€ Freestyleë³´ë‹¤ëŠ” Pipelineì„ ë§ì´ë“¤ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë‘ ë°©ë²•ì˜ ì¥ë‹¨ì ì„ ë¹„êµí•´ë³´ì.

### Freestyle vs Pipeline

- **Freestyle**
  - ì¥ì 
    - ì›¹ ê¸°ë°˜ì˜ GUIë¥¼ í†µí•´ ì—¬ëŸ¬ í”ŒëŸ¬ê·¸ì¸ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - ë‹¨ì :
    - CI íŒŒì´í”„ë¼ì¸ì— ë³€ê²½ ì‚¬í•­ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ì  í‚¨ìŠ¤ì— ë¡œê·¸ì¸í•´ ê°ê°ì˜ í”„ë¦¬ìŠ¤íƒ€ì¼ ì¡ì˜ ì„¤ì •ì„ ë³€ê²½í•´ì•¼ë§Œ í•œë‹¤.
    - CI/CDì˜ ê³¼ì •ì„ ì½˜ì†”ì„ í†µí•´ì„œë§Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    - ê°ê°ì˜ ê³¼ì •ë“¤ì„ í•œë²ˆì— ë³´ê¸° ì–´ë µë‹¤.
- **Pipeline**

  - ì¥ì :

    - íŒŒì´í”„ë¼ì¸ì€ ì½”ë“œë¡œ í”„ë¡œì íŠ¸ ì„¤ì •ì„ í•  ìˆ˜ ìˆì–´ í”„ë¦¬ìŠ¤íƒ€ì¼ê³¼ ë‹¤ë¥´ê²Œ ì  í‚¨ìŠ¤ ì›¹ì— ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•Šì•„ë„ ì„¤ì • ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤. (ì›¹ì„ í†µí•œ ì„¤ì •ë„ ê°€ëŠ¥í•˜ë‹¤.)
    - CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ì •ì„ í•˜ë‚˜ì˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼(Jenkinsfile)ë¡œ í”„ë¡œê·¸ë˜ë°ì„ í†µí•´ í•  ìˆ˜ ìˆë‹¤.
    - Freestyleê³¼ ë‹¤ë¥´ê²Œ í•˜ë‚˜ì˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼(Jenkinsfile)ì„ í†µí•´ íë¦„ ì œì–´ë¥¼ í•  ìˆ˜ ìˆë‹¤.
    - ì¼ë°˜ ì½”ë“œì²˜ëŸ¼ ë²„ì „ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.
    - ì•„ë˜ì™€ ê°™ì´ GUIë¥¼ í†µí•´ í˜„ì¬ ì–´ë–¤ ê³¼ì •ì„ ì§„í–‰ì¤‘ì´ê³  í‰ê· ì ìœ¼ë¡œ ì–¼ë§ˆë§Œí¼ì˜ ì‹œê°„ì´ ê±¸ë ¸ëŠ”ì§€ í†µê³„ì™€ í”¼ë“œë°±ì„ ì¤€ë‹¤.

      ![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_1.png)

  - ë‹¨ì :
    - í”„ë¦¬ìŠ¤íƒ€ì¼ê³¼ ë‹¤ë¥´ê²Œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆë‹¤. ì¦‰, íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ì„ ìœ„í•´ì„œëŠ” ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²•ì„ í•™ìŠµí•˜ì—¬ì•¼ í•œë‹¤.

ìš°ë¦¬ íŒ€ì€ ë‘ ë°©ë²• ëª¨ë‘ ì‚¬ìš©ì„ í•´ë³´ì•˜ìœ¼ë‚˜ Pipelineì´ í•˜ë‚˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì „ì²´ íë¦„ì„ ì•Œ ìˆ˜ ìˆê¸°ì— ë”ìš± ê´€ë¦¬ê°€ í¸í•˜ê³  GUIë¥¼ í†µí•œ ì§„í–‰ê³¼ì •ì„ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆì–´ ìµœì¢…ì ìœ¼ë¡œ Pipelineì„ ì‚¬ìš©í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

ì´ì œ Pipeline í”„ë¡œì íŠ¸ë¥¼ êµ¬ì¶•í•œ ê³¼ì •ì„ ë‹¤ë¤„ë³´ê² ë‹¤.

# Jenkins Pipeline êµ¬ì¶•í•˜ê¸°

## 1. CI êµ¬ì¶•í•˜ê¸°

### 1.1. ì•„ì´í…œ ìƒì„±

Jenkinsì— ì ‘ì† í›„ ì•„ì´í…œ ìƒì„±ì„ í´ë¦­í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤. ìƒì„±í•˜ê³ ìí•˜ëŠ” ì•„ì´í…œì˜ ì´ë¦„ì„ ì…ë ¥ í›„, Pipelineì„ ì„ íƒí•˜ì—¬ ì•„ì´í…œì„ ìƒì„±í•˜ê² ë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_2.png)

ì•„ì´í…œì„ ìƒì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•œ íŒŒì´í”„ë¼ì¸ì˜ ì„¤ì • í˜ì´ì§€ë¡œ ë„˜ì–´ê°ˆ ê²ƒì´ë‹¤. ìš°ì„  ì•ì˜ ì„¤ì •ë“¤ì€ ê±´ë„ˆ ë›°ê³  Script ìª½ìœ¼ë¡œ ë„˜ì–´ê°€ë³´ê² ë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_3.png)

### 1.2. ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë°©ë²•

ì•ì„œ íŒŒì´í”„ë¼ì¸ ë°©ë²•ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í”„ë¡œê·¸ë˜ë°í•˜ì—¬ ì¼ë ¨ì˜ ê³¼ì •ì„ ì„¸íŒ…í•œë‹¤ê³  í•˜ì˜€ë‹¤. ì  í‚¨ìŠ¤ì˜ íŒŒì´í”„ë¼ì¸ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” 2ê°€ì§€ ë°©ë²•ì„ ì œê³µí•˜ê³  ìˆë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_4.png)

1. ì  í‚¨ìŠ¤ ì›¹ ë‚´ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ê´€ë¦¬ â†’ Pipeline Script(default)
2. í”„ë¡œì íŠ¸ ë‚´ì—ì„œ Jenkinsfileì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ê´€ë¦¬ â†’ Pipeline Script from SCM

ìš°ë¦¬ëŠ” ì¼ë‹¨ 1ë²ˆ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ì„ í•˜ê³  ì¶”í›„ 2ë²ˆ ë°©ë²•ìœ¼ë¡œ ë³€ê²½í•´ë³´ë ¤ í•œë‹¤.

### 1.3. ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• ì¢…ë¥˜

Pipeline ScriptëŠ” 2ê°€ì§€ íƒ€ì…ìœ¼ë¡œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ë‹¤. ë‘ ë°©ë²• ëª¨ë‘ Groovyë¬¸ë²• ê¸°ë°˜ì´ë©° ë‘˜ì˜ ì°¨ì´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

- **Declarative Pipeline** : ì‰½ê²Œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ë©° Groovy ë¬¸ë²• ê¸°ë°˜ì´ì§€ë§Œ í•´ë‹¹ ë¬¸ë²•ì„ ëª°ë¼ë„ ì‘ì„± ê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤. (ìµœìƒë‹¨ì— pipeline ì´ë¼ê³  ë˜ì–´ ìˆìœ¼ë©´ declarative ë¬¸ë²•ìœ¼ë¡œ ì‘ì„±ëœ ê²ƒì´ë‹¤.)
- **Scripted Pipeline** : Groovy ë¬¸ë²• ê¸°ë°˜ì´ë©° Declarative ë³´ë‹¤ íš¨ê³¼ì ì´ê³  ë§ì€ ê¸°ëŠ¥ìœ¼ë¡œ í¬í•¨í•´ì„œ ì‘ì„± ê°€ëŠ¥í•œë° ì–´ë µë‹¤. (ìµœìƒë‹¨ì— node ì§€ì‹œì–´ê°€ ìˆìœ¼ë©´ scripted ë¬¸ë²•ìœ¼ë¡œ ì‘ì„±ëœ ê²ƒì´ë‹¤.)

ë‘ ë¬¸ë²•ì„ í˜¼í•©í•´ì„œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ìœ¼ë©° ìƒì„¸í•œ ë‚´ìš©ì€ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.

[Pipeline Syntax](https://www.jenkins.io/doc/book/pipeline/syntax/)

### 1.4. ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±í•˜ê¸°

ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ì— ëŒ€í•œ ë°©ë²•ì€ ë‹¤ë£¨ê²Œ ëœë‹¤ë©´ í•´ë‹¹ í¬ìŠ¤íŠ¸ì˜ ê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ê¸°ì— ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œë„ ë‹¤ë£¨ì§€ ì•Šê² ë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ê°ê°ì˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–¤ ì‘ì—…ì„ í•˜ëŠ”ì§€ë§Œ ì„¤ëª…í•˜ê² ë‹¤. ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ë²•ì— ëŒ€í•´ í•™ìŠµí•˜ê³  ì‹¶ë‹¤ë©´ ìœ„ì˜ ê³µì‹ë¬¸ì„œ ë˜ëŠ” ë‹¤ë¥¸ ë¸”ë¡œê·¸ë“¤ì„ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.

```bash
pipeline {
    agent any

    tools {
        gradle 'gradle'
    }

    stages {
        stage('Git Clone') {
            steps {
                git branch: 'develop-be', url: 'https://github.com/woowacourse-teams/2022-momo.git'
            }
        }
        stage('BE-Build') {
            steps {
                dir("./backend") {
                    sh "./gradlew clean build"
                }
            }
        }
    }
}
```

ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” **Git Clone**ë‹¨ê³„ì—ì„œ Gitì— ì˜¬ë¼ê°€ìˆëŠ” í”„ë¡œì íŠ¸ì˜ `develop-be` ë¸Œëœì¹˜ë¥¼ í´ë¡ ì„ í•˜ë„ë¡ í•˜ì˜€ë‹¤. ê·¸ í›„ **BE-Build** ë‹¨ê³„ë¥¼ í†µí•´ í´ë¡ í•œ í”„ë¡œì íŠ¸ì˜ backend ë””ë ‰í„°ë¦¬ë¡œ ì´ë™ í›„ í”„ë¡œì íŠ¸ ë¹Œë“œë¥¼ í†µí•œ CI ì‘ì—…ì„ ì§„í–‰í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ì´ì™€ ê°™ì€ ì„¤ì •ì„ í•˜ë©´ CI êµ¬ì¶•ì€ ì™„ë£Œí•œ ê²ƒì´ë‹¤. ì§€ê¸ˆê¹Œì§€ ì„¤ì •í•œ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•´ë³´ê² ë‹¤.

ìƒì„±í•œ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë“¤ì–´ê°€ ì¢Œì¸¡ì— ìˆëŠ” ë©”ë‰´ë°”ì—ì„œ ì§€ê¸ˆ ë¹Œë“œë¥¼ í•˜ê²Œëœë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ Git Cloneìœ¼ë¡œë¶€í„° Buildê¹Œì§€ CI ê³¼ì •ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_5.png)

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_6.png)

## 2. CD êµ¬ì¶•í•˜ê¸°

ì´ì œ CI ì‘ì—…ì„ ë§ˆì³¤ìœ¼ë‹ˆ CD ì‘ì—…ì„ ì§„í–‰í•´ë³´ë„ë¡ í•˜ê² ë‹¤.

### 2. 1. SSH ë¥¼ ìœ„í•œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜í•˜ê¸°

> **ğŸš¨Â Publish Over SSH ì ‘ì† ë¶ˆê°€ ì´ìŠˆ**
>
> êµ¬ê¸€ì—ì„œ Jenkins Pipeline ìƒì„±ì„ ë‹¤ë£¬ ê²Œì‹œê¸€ë“¤ì„ ê²€ìƒ‰í•˜ì—¬ ì°¾ì•„ë³´ë©´ ìŠ¤í”„ë§ì´ ì‹¤í–‰ë  ìš´ì˜ì„œë²„ EC2ì˜ ì ‘ê·¼ì„ ìœ„í•œ SSH í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ Publish Over SSHë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆë‹¤. í•˜ì§€ë§Œ Publish Over SSH í”ŒëŸ¬ê·¸ì¸ì€ í˜„ì¬ ì•„ë˜ ë§í¬ì˜ ì„¤ëª…ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ìµœì‹ ì˜ openssh ë²„ì „ì´ ssh-rsa ë°©ì‹ì˜ ì•”í˜¸í™” í‚¤ë¥¼ ë¹„í™œì„±í™” ì‹œí‚¨ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ìš°ë¦¬ì˜ ìš´ì˜ì„œë²„ EC2ë¡œì˜ ì ‘ê·¼ì„ í•˜ê¸° ìœ„í•œ pemëŠ” rsa ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”ë˜ì—ˆê¸°ì— í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì—ì„œ ì—°ê²°ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•˜ì—¬ ë‹¤ë¥¸ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.
>
> (ìš°í…Œì½” í¬ë£¨ì¸ ë£¨í‚¤ëŠ” ë‹¤ë¥¸ ì•”í˜¸í™” ë°©ì‹ìœ¼ë¡œ ì ‘ì†í‚¤ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ë”ë‹ˆ í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì„ ì •ìƒì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆì—ˆë‹¤ê³  í•œë‹¤.)
>
> [Failed to connect and initialize SSH to the Remote Server (Tried All the Possible Ways ) Â· Issue #247 Â· jenkinsci/publish-over-ssh-plugin](https://github.com/jenkinsci/publish-over-ssh-plugin/issues/247#issuecomment-1153768171)

Publish Over SSHë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ì„œë„ ìš´ì˜ì„œë²„ë¡œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ í˜„ì¬ ìƒê°ë‚˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ì´ ìˆë‹¤.

1. Jenkins ì„œë²„ì— pem í‚¤ë¥¼ ë³´ê´€í•˜ê³  ë¦¬ëˆ…ìŠ¤ ëª…ë ¹ì„ í†µí•´ ì ‘ì†í•˜ëŠ” ë°©ë²•
2. ë‹¤ë¥¸ SSH Pluginì„ ì‚¬ìš©í•´ ì ‘ì†í•˜ëŠ” ë°©ë²•

ë‘ ë°©ë²•ì¤‘ ìš°ë¦¬ íŒ€ì€ ë‹¤ë¥¸ SSH Pluginì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ íƒí•˜ì˜€ë‹¤. ìš°ë¦¬ê°€ ì‚¬ìš©í•œ í”ŒëŸ¬ê·¸ì¸ì€ SSH Agentì´ë‹¤. ì„¤ì¹˜ ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

ğŸ“ŒÂ  Jenkins ê´€ë¦¬ â†’ Plugin Manager â†’ ì„¤ì¹˜ ê°€ëŠ¥ ì•± â†’ SSH Agent ê²€ìƒ‰ ë° ì„¤ì¹˜

### 2.2. AWS ì ‘ì†ì •ë³´ ì¶”ê°€í•˜ê¸°

ìš°ë¦¬ê°€ PCì—ì„œ AWS EC2ì— ì ‘ì†ì„ í•  ë•ŒëŠ” `ssh -i {pem key ì´ë¦„}.pem ubuntu@{ipì£¼ì†Œ}`ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ í†µí•´ pem í‚¤ë¥¼ í†µí•´ ì ‘ì†í•˜ì˜€ë‹¤. Jenkins ì„œë²„ì—ì„œ ìš´ì˜ì„œë²„ë¡œ ì ‘ì†ì„ í•  ë•Œë„ ì ‘ì† í‚¤ê°€ í•„ìš”í•˜ê¸°ì— í•´ë‹¹ í‚¤ë¥¼ ë¨¼ì € Jenkinsì— ë“±ë¡í•´ì£¼ê² ë‹¤.

ğŸ“ŒÂ Jenkinsê´€ë¦¬ â†’ ManageCredential

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_7.png)

ğŸ“Œ jenkinsì— ì ‘ì†

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_8.png)

ğŸ“Œ add credentials

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_9.png)

credential ì„¤ì •ì€ ì•„ë˜ì™€ ê°™ì´ kindëŠ” SSH Username with private keyë¥¼ ì„ íƒ í›„ ì•„ë˜ì™€ ê°™ì´ ì¸ì¦ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ë©´ ëœë‹¤.

keyì—ëŠ” pem í‚¤ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ë©´ ëœë‹¤. ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë‚˜ì˜¤ëŠ” í‚¤ ê°’ì„ `-----BEGIN RSA PRIVATE KEY-----` ë¶€í„° `-----END RSA PRIVATE KEY-----`ê¹Œì§€ ëª¨ë‘ ë³µì‚¬í•´ ì…ë ¥í•˜ë©´ ëœë‹¤.

```bash
cat {key ì´ë¦„}.pem

// ê²°ê³¼
-----BEGIN RSA PRIVATE KEY-----
{í‚¤ ê°’ë“¤}
-----END RSA PRIVATE KEY-----
```

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_10.png)

### 2.3. ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±í•˜ê¸°

ì•ì„œ CI ìŠ¤í¬ë¦½íŠ¸ì— ì´ì–´ì„œ ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```bash
pipeline {
    agent any

    tools {
        gradle 'gradle'
    }

    stages {
        stage('Git Clone') {
            steps {
                git branch: 'develop-be', url: 'https://github.com/woowacourse-teams/2022-momo.git'
            }
        }
        stage('BE-Build') {
            steps {
                dir("./backend") {
                    sh "./gradlew clean build"
                }
            }
        }
        stage('Deploy') {
            steps {
                sshagent(credentials: ['aws_key']) {
                    sh '''
                        ssh -o StrictHostKeyChecking=no ubuntu@192.168.xxx.xxx uptime
                        scp /var/jenkins_home/workspace/Momo/backend/build/libs/momo-0.0.1-SNAPSHOT.jar ubuntu@192.168.xxx.xxx:/home/ubuntu/momo

                        ssh -t ubuntu@192.168.xxx.xxx ./deploy.sh
                    '''
                }
            }
        }
    }
}
```

ìš´ì˜ ì„œë²„ë¡œì˜ ë°°í¬ëŠ” ì•ì„œ ì„¤ì¹˜í•œ sshagent í”ŒëŸ¬ê·¸ì¸ì„ ì´ìš©í•´ ì§„í–‰í•˜ì˜€ë‹¤. Deploy ê³¼ì •ì—ì„œ ì§„í–‰í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ë¨¼ì € ì  í‚¨ìŠ¤ ì„œë²„ì—ì„œ ìš´ì˜ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ `StrictHostKeyChecking`ë¥¼ ë¹„í™œì„±í™” ì‹œì¼œì¤€ë‹¤. ê·¸ í›„ `scp`ë¥¼ í†µí•´ ë¹Œë“œëœ `jar`íŒŒì¼ì„ ìš´ì˜ ì„œë²„ë¡œ ì „ì†¡ì‹œí‚¨ í›„, ìš´ì˜ ì„œë²„ì— ë¯¸ë¦¬ ì‘ì„±í•œ `deploy.sh` íŒŒì¼ì„ ì‹¤í–‰í•˜ì—¬ ë¹Œë“œëœ íŒŒì¼ì„ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.

`deploy.sh`íŒŒì¼ì˜ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```bash
#!/bin/bash
pid=$(pgrep -f momo)

if [ -n "${pid}" ]
then
        kill -15 ${pid}
        echo kill process ${pid}
else
        echo no process
fi

chmod +x ./momo/momo-0.0.1-SNAPSHOT.jar
nohup java -jar ./momo/momo-0.0.1-SNAPSHOT.jar >> application.log 2> /dev/null &
```

ì§€ê¸ˆê¹Œì§€ ì„¤ì •í•œ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ Git Clone-Build-Deloyì˜ ê³¼ì •ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_11.png)

## 3. Webhook ë“±ë¡í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ Jenkinsì—ì„œ CI/CDì‘ì—…ì„ í•˜ëŠ” í•˜ë‚˜ì˜ Pipelineì„ ë§Œë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•œ ë‚´ìš©ì€ Jenkinsì—ì„œ ì§ì ‘ ë¹Œë“œë¥¼ í•˜ì—¬ì•¼ë§Œ ì‹¤í–‰ì´ ëœë‹¤. ì¦‰, CI/CD íŒŒì´í”„ë¼ì¸ì€ ë§Œë“¤ì—ˆìœ¼ë‚˜ í•´ë‹¹ ì‘ì—…ì—…ì˜ ìë™í™”ëŠ” ë“±ë¡ë˜ì§€ ì•Šì€ ê²ƒì´ë‹¤. ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” Githubì˜ Webhookì„ í†µí•´ í”„ë¡œì íŠ¸ ë ˆí¬ì§€í† ë¦¬ì— í‘¸ì‰¬ê°€ ì¼ì–´ë‚¬ì„ ë•Œ ìë™ìœ¼ë¡œ CI/CDê°€ ë™ì‘í•˜ë„ë¡ ë§Œë“¤ì–´ë³´ë ¤í•œë‹¤.

ë¨¼ì € ì•ì„œ ë§Œë“  ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ì— ì ‘ì†í•˜ì—¬ ì„¤ì • ì°½ì—ì„œ `GitHub hook trigger for GITScm polling` ì„ í™œì„±í™”í•´ì¤€ë‹¤. í•´ë‹¹ ì˜µì…˜ì„ í™œì„±í™”í•´ì£¼ë©´ githubì—ì„œ webhookì´ ë“¤ì–´ì™”ì„ ë•Œ ìë™ìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ì´ ë¹Œë“œëœë‹¤.

ğŸ“ŒÂ  {ì•ì„œ ë§Œë“  íŒŒì´í”„ë¼ì¸ ì•„ì´í…œ}ì ‘ì† â†’ êµ¬ì„± â†’ Build Triggers â†’ GitHub hook trigger for GITScm polling í™œì„±í™”

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_12.png)

ì´ì œ Github í”„ë¡œì íŠ¸ ë ˆí¬ì§€í† ë¦¬ì— ì ‘ì†í•˜ì—¬ Webhookì„ ë§Œë“¤ì–´ë³´ê² ë‹¤. í”„ë¡œì íŠ¸ ë ˆí¬ì§€í† ë¦¬ì˜ Settingì— ë“¤ì–´ê°€ë©´ Webhook ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤. Webhookì— ë“¤ì–´ê°€ì„œ Add webhookì„ í´ë¦­í•´ë³´ì.

ğŸ“ŒÂ  Setting â†’ Webhook â†’ Add webhook

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_13.png)

Payload URLì—ëŠ” `https://{ì  í‚¨ìŠ¤ ì ‘ì† ì£¼ì†Œ}/github-webhook/`ì˜ ê°’ì„ ì…ë ¥í•˜ê³  Content typeì€ `application/json` ì„ ì„ íƒí•´ì¤€ë‹¤. webhookì„ triggerí•  ì„ íƒì€ 3ê°€ì§€ ì„ íƒì§€ê°€ ìˆëŠ”ë° ìš°ë¦¬ëŠ” Just the push eventë¡œ ì„¤ì •í•´ë‘ê³  Webhookì„ ì¶”ê°€í•´ë³´ê² ë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_14.png)

ì´ë ‡ê²Œ Webhook ë“±ë¡ì´ ëë‚¬ë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_15.png)

ì´ì œ PRì´ ë¨¸ì§€ë˜ë©´ Githubì—ì„œ Webhookì„ ë‚ ë ¤ì„œ ì•„ë˜ì™€ ê°™ì´ CI/CDì‘ì—…ì´ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ê²Œ ë˜ì—ˆë‹¤.

![Untitled](image/20220717_CICD_êµ¬ì¶•ê¸°2/img_16.png)

# ë§ˆë¬´ë¦¬

ì§€ê¸ˆê¹Œì§€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ì  í‚¨ìŠ¤ë¥¼ í†µí•œ CI/CDì‘ì—…ì„ ì •ë¦¬í•´ë´¤ë‹¤. í˜„ì¬ëŠ” ë°±ì—”ë“œê°€ ì•„ì§ MySQLê³¼ ê°™ì€ DBì—°ê²°ì„ í•˜ì§€ ì•Šê³  ì¸ë©”ëª¨ë¦¬ í˜•íƒœì¸ H2 DBë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ë‹¨ìˆœíˆ ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ë¥¼ ìš´ì˜ì„œë²„ì— ë°°í¬ ë° ì‹¤í–‰í•˜ëŠ” ë‹¨ê³„ê¹Œì§€ë§Œ ì§„í–‰í•˜ì˜€ë‹¤. ì•ìœ¼ë¡œëŠ” CI/CDì‘ì—…ì„ í•˜ë©° DB ì¸ìŠ¤í„´ìŠ¤(EC2)ë¥¼ ì—°ê²°í•˜ëŠ” ê³¼ì • ë° í”„ë¡ íŠ¸ì˜ CI/CDì‘ì—…ì„ ì¶”ê°€í•´ë³´ë ¤ í•œë‹¤.

# Reference

- [[ìš°ì  êµ¬2í¸] ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ì„ í™œìš©í•œ ë°°í¬ ìë™í™”](https://velog.io/@sihyung92/%EC%9A%B0%EC%A0%A0%EA%B5%AC2%ED%8E%B8-%EC%A0%A0%ED%82%A8%EC%8A%A4-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94)
- [Jenkins pipeline ì‚¬ìš©í•´ë³´ê¸°](https://velog.io/@revelation/Jenkins-pipeline-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0)
- [[AWS] Jenkinsë¥¼ í™œìš©í•œ Docker x SpringBoot CI/CD êµ¬ì¶•](https://velog.io/@haeny01/AWS-Jenkins%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-Docker-x-SpringBoot-CICD-%EA%B5%AC%EC%B6%95)
- [[Jenkins] Jenkinsë¥¼ ì´ìš©í•œ ë°°í¬ ìë™í™”(1) - Dockerë¡œ Jenkins ì„¤ì¹˜ ë°©ë²•](https://minsoolog.tistory.com/43?category=971650)
- [Jenkins ì™€ Docker ê·¸ë¦¬ê³  AWS CLI ì‚½ì§ˆê¸° ì •ë¦¬í•˜ê¸°](https://pks2974.medium.com/jenkins-%EC%99%80-docker-%EA%B7%B8%EB%A6%AC%EA%B3%A0-aws-cli-%EC%82%BD%EC%A7%88%EA%B8%B0-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-e728986960e2)
- [Jenkins + CodeDeployë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ë°°í¬ êµ¬í˜„í•˜ê¸°](https://velog.io/@bluewind8791/jenkins-with-docker-ci)
- [ğŸ“™ AWS EC2ì— Jenkins ì„œë²„ êµ¬ì¶•](https://velog.io/@hmyanghm/AWS-EC2%EC%97%90-Jenkins-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95#---%ED%94%84%EB%A6%AC%ED%8B%B0%EC%96%B4-ec2-%EC%8A%A4%EC%99%91-%ED%8C%8C%ED%8B%B0%EC%85%98-%EC%83%9D%EC%84%B1)
- [Pipeline Syntax](https://www.jenkins.io/doc/book/pipeline/syntax/)
- [java.nio.file.AccessDeniedException at Jenkins build](https://stackoverflow.com/questions/35011699/java-nio-file-accessdeniedexception-at-jenkins-build)
- [ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ë¬¸ë²•(Pipeline Syntax) ì´ì •ë¦¬](https://blog.voidmainvoid.net/104)
