---
title: "Jenkinsë¥¼ í†µí•œ CI/CD êµ¬ì¶•ê¸° 4í¸ (Backend DB êµ¬ì¶•)"
date: 2022-08-14
tags: ["DevOps", "CI/CD", "Jenkins", "AWS", "EC2", "React", "MySQL"]
draft: false
---

> í•´ë‹¹ í¬ìŠ¤íŠ¸ëŠ” ëª¨ëª¨íŒ€ í¬ë£¨ [ë ‰ìŠ¤](https://github.com/Seongwon97)ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ì „ê¹Œì§€ì˜ ê³¼ì •ìœ¼ë¡œëŠ” DBë¥¼ Springì˜ ì¸ë©”ëª¨ë¦¬ H2 DBë¥¼ ì‚¬ìš©í•˜ì—¬ CI/CDê³¼ì •ì´ ì§„í–‰ë  ë•Œë§ˆë‹¤ DBë°ì´í„°ë“¤ì´ ì´ˆê¸°í™”ë˜ì—ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” DBë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ë³´ê´€í•˜ê¸° ìœ„í•´ MySQL DBë¥¼ êµ¬ì¶• ë° ì—°ê²°í•˜ëŠ” ê³¼ì •ì„ ë‹¤ë¤„ë³´ë ¤ í•œë‹¤.

# 1. DBì„œë²„ ìƒì„± ë° MySQL ì„¤ì¹˜

DBì„œë²„ëŠ” ì•ì„  ê³¼ì •ì—ì„œ ë§Œë“¤ì—ˆë˜ EC2ì™€ëŠ” ë‹¤ë¥´ê²Œ ì™¸ë¶€ì™€ì˜ ì ‘ê·¼ì„ ì—´ì–´ë‘˜ í•„ìš”ê°€ ì—†ê¸°ì— Public IPí• ë‹¹ ì—†ì´ EC2ë¥¼ ìƒì„±í•˜ë©´ ë³´ì•ˆì ìœ¼ë¡œ ì´ì ì„ ì–»ì„ ìˆ˜ ìˆë‹¤. Private IPë§Œì„ ê°–ê³ ìˆëŠ” EC2ë¥¼ ìƒì„±í•œ í›„, ì•„ë˜ì˜ ê²Œì‹œê¸€ì„ ë”°ë¼ MySQLì„ ì„¤ì¹˜í•´ë³´ê² ë‹¤.

> MySQLì„¤ì¹˜ ë‚´ìš©ë§Œìœ¼ë¡œë„ ë‚´ìš©ì´ ë°©ëŒ€í•˜ì—¬ í¬ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬í•˜ì˜€ë‹¤.
> - [[AWS] Private Ec2ì— MySQLì„¤ì¹˜ ë° ì›ê²© ì ‘ì† ì„¤ì •í•˜ê¸°](https://seongwon.dev/DevOps/20220813-MySQL%EC%84%A4%EC%B9%98_%EC%9B%90%EA%B2%A9%EC%A0%91%EC%86%8D%EC%84%A4%EC%A0%95/)

# 2. ì„œë¸Œëª¨ë“ˆì„ í†µí•œ DB ì •ë³´ ê´€ë¦¬

ì´ì œ ì•ì„œ ë§Œë“  DBì„œë²„ë¥¼ ìš°ë¦¬ê°€ ë§Œë“  Spring í”„ë¡œì íŠ¸ì— ì—°ê²°í•˜ì—¬ì•¼ í•œë‹¤. ì´ë•Œ DBì •ë³´ëŠ” ì™¸ë¶€ì— ë…¸ì¶œë˜ë©´ ì•ˆë˜ê¸°ì— ë‹¤ë¥¸ í”„ë¡œì íŠ¸ íŒŒì¼ë“¤ê³¼ í•¨ê»˜ ì˜¬ë ¤ì„œëŠ” ì•ˆ ë˜ê¸°ì— DBì •ë³´ ì—°ê²°ì— ëŒ€í•´ì„œëŠ” ìƒê°ì„ ì¢€ í•´ë´ì•¼ í•œë‹¤.

ì§€ê¸ˆ ìƒê°ë‚˜ëŠ” DB ì •ë³´ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œ ì—†ì´ ì ìš©í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

1. ë°°í¬ì„œë²„ì— DBì •ë³´ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ ì—°ê²°í•˜ëŠ” ë°©ë²•
2. ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ë¹Œë“œ ì´ì „ì— í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ë²•
3. ì„œë¸Œëª¨ë“ˆì„ í†µí•´ ê´€ë¦¬í•˜ëŠ” ë°©ë²•

í•˜ì§€ë§Œ ê°ê°ì˜ ë°©ë²•ì„ ìƒê°í•´ë´¤ì„ ë•Œ, ì²«ë²ˆì§¸ ë°©ë²•ì€ ê°ê°ì˜ ì‹¤í–‰ ì„œë²„ì— DBì •ë³´ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•´ì¤˜ì•¼í•˜ê¸°ì— ë°°í¬ ì„œë²„ê°€ 1ê°œê°€ ì•„ë‹Œ ì—¬ëŸ¬ê°œê°€ ì¡´ì¬í•œë‹¤ë©´ ì—¬ëŸ¬ê°œì˜ ì„œë²„ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ì„¤ì •ì„ í•´ì¤˜ì•¼ í•  ê²ƒì´ë‹¤. ë˜í•œ DBì •ë³´ê°€ ì—…ë°ì´íŠ¸ë  ê²½ìš° ë‹¤ì‹œ ì—¬ëŸ¬ê°œì˜ ì„œë²„ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ê°ê° ì—…ë°ì´íŠ¸ë¥¼ í•´ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ë°œìƒí•  ê²ƒì´ë‹¤.

ë‘ë²ˆì§¸ ë°©ë²•ì€ ë¹Œë“œ ì´ì „ì— í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ì„ í•œ ë²ˆë§Œ ì—…ë°ì´íŠ¸ í•´ì£¼ë©´ ë˜ê¸°ì— ì•ì„œ ìˆë˜ ë¬¸ì œëŠ” í•´ê²°í•  ìˆ˜ ìˆìœ¼ë‚˜, í•´ë‹¹ ë°©ë²• ë˜í•œ DBì˜ ë³€ê²½ì ì´ ìˆì„ ê²½ìš° ë¹Œë“œë¥¼ ë‹´ë‹¹í•˜ëŠ” Jenkins ì„œë²„ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ë°œìƒí•  ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ìµœì¢…ì ìœ¼ë¡œ ì„œë¸Œëª¨ë“ˆì„ ë„ì…í•˜ê²Œ ë˜ì—ˆë‹¤. ì„œë¸Œëª¨ë“ˆì„ ë„ì…í•¨ìœ¼ë¡œì¨ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ë‹¤.

> [Git Submodule](https://seongwon.dev/Git/20220811-Git%20Submodule%EC%9D%B4%EB%9E%80/)ì— ëŒ€í•œ ìì„¸í•œ ì‚¬ìš©ë²•ì€ ë‚´ìš©ì€ ë‹¤ìŒ í¬ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.
>

ìœ„ì˜ í¬ìŠ¤íŠ¸ë¥¼ ì°¸ì¡°í•˜ì—¬ DBì™€ JWTí† í° ê°’ê³¼ ê°™ì´ ì™¸ë¶€ì— ë…¸ì¶œë˜ë©´ ì•ˆë˜ëŠ” ì •ë³´ë¥¼ ë‹´ê¸° ìœ„í•œ Private ë ˆí¬ë¥¼ ë§Œë“¤ì–´ ì•„ë˜ì™€ ê°™ì€ DB ì„œë²„ì˜ MySQLì •ë³´ë¥¼ ì¶”ê°€í•˜ê³  Submoduleì„ ì—°ë™í–ˆë‹¤.

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: {userName}
    password: {password}
    url: jdbc:mysql://xxx.xxx.xxx.xxx:3306/momo?serverTimezone=UTC&characterEncoding=UTF-8
  jpa:
    hibernate.ddl-auto: validate
    database-platform: org.hibernate.dialect.MySQL8Dialect
```

# 3. Jenkins íŒŒì´í”„ë¼ì¸ì— Submodule ì„¤ì •í•˜ê¸°

Private ë ˆí¬ë¥¼ ë§Œë“¤ì–´ Submoduleì„ ì—°ë™í–ˆë‹¤ë©´ Jenkinsì—ì„œë„ í•´ë‹¹ ì„œë¸Œëª¨ë“ˆì— ì ‘ê·¼ì„ í•˜ê¸° ìœ„í•œ ê¶Œí•œì„ ì£¼ê¸° ìœ„í•´ Github Tokenì„ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.

![Untitled](image/20220814-CICD_êµ¬ì¶•ê¸°4/img.png)

ğŸ“Œ add credentials

![Untitled](image/20220814-CICD_êµ¬ì¶•ê¸°4/img_1.png)

ğŸ“Œ submoduleì— ì ‘ê·¼ ê°€ëŠ¥í•œ Github ìœ ì €ì˜ Github Tokenì„ Passwordì— ì…ë ¥í•˜ë©° Credentialì„ ì¶”ê°€í•œë‹¤.

![Untitled](image/20220814-CICD_êµ¬ì¶•ê¸°4/img_2.png)

Tokenì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ì´ì œ Jenkinsì—ì„œë„ í”„ë¡œì íŠ¸ì— ì—°ê²°ëœ ì„œë¸Œëª¨ë“ˆì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

![Untitled](image/20220814-CICD_êµ¬ì¶•ê¸°4/img_3.png)

ë§ˆì§€ë§‰ìœ¼ë¡œ Pipelineì—ì„œ gitì—ì„œ ìµœì‹ í™” íŒŒì¼ì„ cloneí•  ë•Œ, ì•ì„œ ì¶”ê°€í•œ credentialë¡œ submoduleíŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ DBì—°ê²° ê³¼ì •ì´ ëë‚˜ê²Œ ëœë‹¤.

Git Clone Stageì— ì„œë¸Œëª¨ë“ˆì„ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```bash
pipeline {
    agent any

    stages {
        stage('Git Clone') {
            steps {
                git branch: 'develop-be', url: 'https://github.com/woowacourse-teams/2022-momo.git'
                withCredentials([GitUsernamePassword(credentialsId: 'submodule_security_token', gitToolName: 'Default')]) {
                    sh 'git submodule update --init --recursive'
                }
            }
        }
        ...
    }
}
```

# ë§ˆì¹˜ë©°

ì§€ê¸ˆê¹Œì§€ Jenkinsë¥¼ í†µí•œ CI/CD êµ¬ì¶•1~4 ê³¼ì •ë“¤ì„ í†µí•´ Jenkinsë¥¼ í†µí•´ ë°±ì—”ë“œ, í”„ë¡ íŠ¸ì—”ë“œì˜ ë°°í¬ ìë™í™”ë¥¼ êµ¬ì¶•í•˜ì˜€ë‹¤. ì²˜ìŒ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•´ë³¸ë§Œí¼ ë§ì€ í•™ìŠµê³¼ ì‹œí–‰ì°©ì˜¤ë¥¼ ê²ªìœ¼ë©° ì™„ì„±í•œ í˜„ì¬ì˜ í”„ë¡œì íŠ¸ì˜ ì¸í”„ë¼ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

![Untitled](image/20220814-CICD_êµ¬ì¶•ê¸°4/img_4.png)

ì¸í”„ë¼ êµ¬ì¡°ëŠ” HTTPSë¥¼ ë„ì…í•˜ê³  Load Balancingì„ ìœ„í•´ ë°°í¬ ì„œë²„ë¥¼ ì—¬ëŸ¬ê°œ ìƒì„±í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•˜ê²Œ ëœë‹¤ë©´ êµ¬ì¡°ê°€ ë³€ê²½ë  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤. ì¸í”„ë¼ë„ ìš°ë¦¬ê°€ ì‘ì„±í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œë¥¼ ë¦¬í™í„°ë§ í•˜ëŠ” ê²ƒê³¼ ê°™ì´ ì§€ì†ì ìœ¼ë¡œ ë” ë‚˜ì€ êµ¬ì¡°ê°€ ì—†ëŠ”ì§€ ìƒê°í•˜ê³  ì°¾ì•„ë³´ë©° ìœ ë™ì ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ë³€ê²½í•´ë³´ê³ ì í•œë‹¤.
