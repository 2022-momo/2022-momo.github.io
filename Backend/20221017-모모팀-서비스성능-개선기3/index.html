<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0"/><style data-href="/styles.d53766664f3eaba3db40.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}</style><meta name="generator" content="Gatsby 2.32.13"/><style type="text/css">
    .toc-header.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .toc-header.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .toc-header svg,
    h2 .toc-header svg,
    h3 .toc-header svg,
    h4 .toc-header svg,
    h5 .toc-header svg,
    h6 .toc-header svg {
      visibility: hidden;
    }
    h1:hover .toc-header svg,
    h2:hover .toc-header svg,
    h3:hover .toc-header svg,
    h4:hover .toc-header svg,
    h5:hover .toc-header svg,
    h6:hover .toc-header svg,
    h1 .toc-header:focus svg,
    h2 .toc-header:focus svg,
    h3 .toc-header:focus svg,
    h4 .toc-header:focus svg,
    h5 .toc-header:focus svg,
    h6 .toc-header:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32-1134414851454382d55f3e82eb460d40.png" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3F4145"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384-1134414851454382d55f3e82eb460d40.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512-1134414851454382d55f3e82eb460d40.png"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">모모팀 서비스 성능 개선기3 (CUD 쿼리 개선) | 모모의 기술 블로그</title><meta data-react-helmet="true" name="description" content="들어가며 모모팀 서비스 개선을 하며 지금까지 의존관계와 조회 쿼리 개선을 진행하였다. 이번 포스트에서는 지난 조회쿼리 개선에 이어서 남은 CUD관련 기능의 쿼리를 분석 및 개선하며 경험한 내용에 대해 정리를 해보려고 한다. 앞서 진행한 의존관계 개선과 조회 쿼리 개선 관련 내용을 확인하고 싶다면 아래의 포스트를 확인하길 바란다. 모모팀 서비스 성능 개선기…"/><meta data-react-helmet="true" property="og:title" content="모모팀 서비스 성능 개선기3 (CUD 쿼리 개선)"/><meta data-react-helmet="true" property="og:image" content="/static/social-image-78ea8dbe9ea55ddf7384fb9b357c15ca.png"/><meta data-react-helmet="true" property="og:description" content="들어가며 모모팀 서비스 개선을 하며 지금까지 의존관계와 조회 쿼리 개선을 진행하였다. 이번 포스트에서는 지난 조회쿼리 개선에 이어서 남은 CUD관련 기능의 쿼리를 분석 및 개선하며 경험한 내용에 대해 정리를 해보려고 한다. 앞서 진행한 의존관계 개선과 조회 쿼리 개선 관련 내용을 확인하고 싶다면 아래의 포스트를 확인하길 바란다. 모모팀 서비스 성능 개선기…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image" content="/static/social-image-78ea8dbe9ea55ddf7384fb9b357c15ca.png"/><meta data-react-helmet="true" name="twitter:creator" content="momo"/><meta data-react-helmet="true" name="twitter:title" content="모모팀 서비스 성능 개선기3 (CUD 쿼리 개선)"/><meta data-react-helmet="true" name="twitter:description" content="들어가며 모모팀 서비스 개선을 하며 지금까지 의존관계와 조회 쿼리 개선을 진행하였다. 이번 포스트에서는 지난 조회쿼리 개선에 이어서 남은 CUD관련 기능의 쿼리를 분석 및 개선하며 경험한 내용에 대해 정리를 해보려고 한다. 앞서 진행한 의존관계 개선과 조회 쿼리 개선 관련 내용을 확인하고 싶다면 아래의 포스트를 확인하길 바란다. 모모팀 서비스 성능 개선기…"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-91d2ca5880d6e7d8e505.js"/><link as="script" rel="preload" href="/framework-eb684e3e828ad13b3940.js"/><link as="script" rel="preload" href="/styles-84a9bc99193fe5828ffe.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-17eb047fb821ccbad0b0.js"/><link as="script" rel="preload" href="/app-d1a6932a45bfd024ad29.js"/><link as="script" rel="preload" href="/d7eeaac4-dcbe97e7a5aa158c9d08.js"/><link as="script" rel="preload" href="/5e2a4920-da90abce4a08c86a094c.js"/><link as="script" rel="preload" href="/1bfc9850-409296e666dade882413.js"/><link as="script" rel="preload" href="/commons-b839ac3ef2817b5d267d.js"/><link as="script" rel="preload" href="/7a297f752dcfe258c0b0106d89edb3a916af916e-ba3bed115b500439fc94.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-4910a6c560d7a355cf37.js"/><link as="fetch" rel="preload" href="/page-data/Backend/20221017-모모팀-서비스성능-개선기3/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3911196313.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4111100897.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><style data-emotion-css="zp4s6h">.css-zp4s6h{position:fixed;bottom:0;left:0;margin-left:0.5rem;margin-bottom:0.5rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-size:0.875rem;font-weight:700;padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:0.75rem;background-color:#A5CC82;z-index:9999;}</style><div class="css-zp4s6h"><style data-emotion-css="5x4yj0">.css-5x4yj0{fill:currentColor;width:1.5rem;height:1.5rem;margin-right:0.5rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" class="css-5x4yj0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg><style data-emotion-css="1f2k2gl">.css-1f2k2gl{margin-left:0.5rem;}</style><div class="css-1f2k2gl">Please enable JavaScript to use this site.<br/>JavaScript를 활성화 시켜주세요.</div></div></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="f6s0ma">.css-f6s0ma{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><style data-emotion-css="acifd">.css-acifd{min-height:100vh;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><div class="css-acifd e5jinln0"><style data-emotion-css="8ezs2g">.css-8ezs2g{min-height:calc(100vh - 100px);}</style><div class="css-8ezs2g"><style data-emotion-css="17vgyms">.css-17vgyms{background:linear-gradient( 90deg,#00467F,#A5CC82 );}</style><div class="css-17vgyms"><style data-emotion-css="1mqm4zt">.css-1mqm4zt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:1280px;margin-left:auto;margin-right:auto;padding:1.25rem;}</style><nav class="css-1mqm4zt eocge8f0"><style data-emotion-css="1usmgm5">.css-1usmgm5{font-size:1.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-weight:700;}</style><a class="css-1usmgm5" href="/">모모팀의 기술 블로그</a><a aria-label="search page" href="/search"><style data-emotion-css="47445j">.css-47445j{--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));margin-top:auto;margin-bottom:auto;width:2rem;height:2rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="1d3ps91">.css-1d3ps91{background:linear-gradient( 90deg,#00467F,#A5CC82 );position:fixed;width:100%;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);z-index:100;-webkit-transition:all 300ms cubic-bezier(0,0,0.2,1);transition:all 300ms cubic-bezier(0,0,0.2,1);top:-100px;}</style><div class="css-1d3ps91"><nav class="css-1mqm4zt eocge8f0"><a class="css-1usmgm5" href="/">모모팀의 기술 블로그</a><a aria-label="search page" href="/search"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="w27u98">.css-w27u98{margin-top:1rem;padding-left:1rem;padding-right:1rem;}</style><div class="blog-post-container css-w27u98"><div class="blog-post"><style data-emotion-css="1bdwg0l">.css-1bdwg0l{width:100%;max-width:768px;margin-left:auto;margin-right:auto;}</style><div class="css-1bdwg0l e6qprj20"><style data-emotion-css="1abxlfd">.css-1abxlfd{font-size:2.25rem;font-weight:700;margin-bottom:1rem;}@media (min-width:768px){.css-1abxlfd{font-size:3rem;}}</style><h1 class="blog-title css-1abxlfd">모모팀 서비스 성능 개선기3 (CUD 쿼리 개선)</h1><style data-emotion-css="cpn9zx">.css-cpn9zx{font-size:1rem;margin-bottom:1rem;}</style><h2 class="blog-date css-cpn9zx">2022년 10월 17일</h2><style data-emotion-css="cet0rr">.css-cet0rr{margin-bottom:0.5rem;}</style><div class="blog-tags css-cet0rr"><style data-emotion-css="engchn">.css-engchn{white-space:nowrap;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);font-size:1rem;font-weight:700;border-radius:9999px;margin-right:0.5rem;margin-top:0.25rem;margin-bottom:0.25rem;padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#edf2f7;color:#00467F;}</style><button class="css-engchn">SpringFramework</button><button class="css-engchn">성능 개선기</button><button class="css-engchn">CUD 쿼리 개선</button><button class="css-engchn">orphanRemoval의 문제</button><button class="css-engchn">OneToMany 단방향 관계의 문제</button></div><style data-emotion-css="1l4w6pd">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="css-1l4w6pd"><style data-emotion-css="164tafw">.css-164tafw{border-radius:9999px;width:100%;height:1px;--bg-opacity:1;background-color:rgba(247,250,252,var(--bg-opacity));background:linear-gradient( 270deg,#00467F,#A5CC82,#FFC500 );}</style><div class="css-164tafw"></div></div></div><div class="blog-content"><style data-emotion-css="qwqmam">.css-qwqmam{-webkit-scrollbar-width:thin;-moz-scrollbar-width:thin;-ms-scrollbar-width:thin;scrollbar-width:thin;-webkit-scrollbar-color:gray transparent;-moz-scrollbar-color:gray transparent;-ms-scrollbar-color:gray transparent;scrollbar-color:gray transparent;display:none;}.css-qwqmam::-webkit-scrollbar{width:4px;}.css-qwqmam::-webkit-scrollbar-track{background-color:transparent;}.css-qwqmam::-webkit-scrollbar-thumb{border-radius:9999px;background-color:gray;}.css-qwqmam::-webkit-scrollbar-button{width:0;height:0;}@media screen and (min-width:1280px){.css-qwqmam{float:right;position:-webkit-sticky;position:sticky;top:100px;width:calc((100vw - 720px) / 2 - 80px);max-width:250px;margin-right:1rem;overflow:auto;word-break:break-word;max-height:calc(100vh - 200px);fontsize:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-left-width:4px;border-image:linear-gradient( 180deg,#00467F,#A5CC82,#FFC500 );border-image-slice:1;}}</style><div class="css-qwqmam"><style data-emotion-css="13af3fo">.css-13af3fo{margin-left:1rem;margin-right:1rem;}</style><div class="css-13af3fo"><style data-emotion-css="17i5xbf">.css-17i5xbf{font-weight:700;margin-bottom:0.5rem;font-size:1.125rem;--text-opacity:1;color:rgba(74,85,104,var(--text-opacity));}</style><h3 class="css-17i5xbf">TOC</h3><style data-emotion-css="1me4zjn">.css-1me4zjn ul{margin-left:0.5rem;}.css-1me4zjn ul > li a:hover{color:#555555;}.css-1me4zjn ul > li a{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);--text-opacity:1;color:rgba(160,174,192,var(--text-opacity));font-size:0.875rem;}.css-1me4zjn ul > li a[href=""]{font-size:0.95rem;color:#555555;}</style><div class="css-1me4zjn"><ul>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0">들어가며</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EA%B0%9D%EC%B2%B4-%EB%B0%8F-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84">객체 및 테이블의 연관관계</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EA%B0%9C%EC%84%A0-%EC%A0%84-%EC%BF%BC%EB%A6%AC-%EB%B6%84%EC%84%9D">개선 전 쿼리 분석</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#group%EA%B3%BC-scheduleonetomany-%EB%8B%A8%EB%B0%A9%ED%96%A5-%EA%B4%80%EA%B3%84%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90">Group과 Schedule..OneToMany 단방향 관계의 문제점</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#orphanremoval%EC%97%90-%EC%9D%98%EC%A1%B4%EC%A0%81%EC%9D%B8-%EC%82%AD%EC%A0%9C-%EB%A1%9C%EC%A7%81%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90">orphanRemoval에 의존적인 삭제 로직의 문제점</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EB%AA%A8%EC%9E%84-%EC%88%98%EC%A0%95-%EB%A1%9C%EC%A7%81%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90">모임 수정 로직의 문제점</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EA%B0%9C%EC%84%A0-%EC%A0%84%ED%9B%84-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94-%EC%BF%BC%EB%A6%AC-%EC%88%98-%EB%B9%84%EA%B5%90">개선 전/후 실행되는 쿼리 수 비교</a></li>
<li><a href="/Backend/20221017-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B03/#%EB%A7%88%EC%B9%98%EB%A9%B0">마치며</a></li>
</ul></div></div></div><div class="css-1bdwg0l e6qprj20"><div><style data-emotion-css="14b4smw">.css-14b4smw{font-size:1rem;word-break:break-word;}.css-14b4smw h1 > a > svg,.css-14b4smw h2 > a > svg,.css-14b4smw h3 > a > svg,.css-14b4smw h4 > a > svg,.css-14b4smw h5 > a > svg,.css-14b4smw h6 > a > svg{fill:#000;}.css-14b4smw h1,.css-14b4smw h2{font-size:1.25rem;font-weight:600;margin-top:1.5rem;margin-bottom:1.5rem;}.css-14b4smw h3,.css-14b4smw h4,.css-14b4smw h5,.css-14b4smw h6{font-size:1.125rem;margin-top:1.5rem;margin-bottom:1.5rem;font-weight:600;}@media (min-width:640px){.css-14b4smw h1,.css-14b4smw h2{font-size:1.5rem;}.css-14b4smw h3,.css-14b4smw h4,.css-14b4smw h5,.css-14b4smw h6{font-size:1.25rem;}}.css-14b4smw a{color:#00467F;}.css-14b4smw a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-14b4smw p{margin:0.3rem;margin-top:0.75rem;margin-bottom:0.75rem;}.css-14b4smw ul,.css-14b4smw ol{margin:0.3rem;margin-left:2rem;}.css-14b4smw li > p,.css-14b4smw li > ul,.css-14b4smw li > ol{margin-bottom:0;}.css-14b4smw ol{list-style-type:decimal;}.css-14b4smw ul{list-style-type:disc;}.css-14b4smw blockquote{padding:0.5rem;background-color:#eee;margin:0.3rem;margin-top:0.5rem;margin-bottom:0.5rem;border-left-width:4px;border-color:#A5CC82;}.css-14b4smw blockquote > p{margin:0.5rem;}.css-14b4smw blockquote > h1,.css-14b4smw blockquote > h2,.css-14b4smw blockquote > h3,.css-14b4smw blockquote > h4,.css-14b4smw blockquote > h5{margin-top:0.5rem;margin-bottom:0.5rem;}.css-14b4smw td,.css-14b4smw th{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-width:1px;border-color:#A5CC82;}.css-14b4smw tr:nth-of-type(even){background-color:#eee;}.css-14b4smw th{background-color:#eee;}.css-14b4smw table{margin-bottom:1.5rem;display:block;max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;margin:0 auto;overflow-x:auto;white-space:nowrap;}.css-14b4smw p > code,.css-14b4smw li > code{padding-top:0.1rem;padding-bottom:0.1rem;padding-right:0.25rem;padding-left:0.25rem;border-radius:0.25rem;color:#00467F;background-color:#eee;white-space:pre-line;}.css-14b4smw pre.grvsc-container{margin-top:24px;margin-bottom:24px;}.css-14b4smw hr{margin-top:24px;margin-bottom:24px;height:2px;border:none;background:linear-gradient( 270deg,#00467F,#A5CC82,#FFC500 );}</style><div class="markdown css-14b4smw"><h1 id="들어가며" style="position:relative;"><a href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0" aria-label="들어가며 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>들어가며</h1>
<p>모모팀 서비스 개선을 하며 지금까지 의존관계와 조회 쿼리 개선을 진행하였다. 이번 포스트에서는 지난 조회쿼리 개선에 이어서 남은 CUD관련 기능의 쿼리를 분석 및 개선하며 경험한 내용에 대해 정리를 해보려고 한다.</p>
<blockquote>
<p>앞서 진행한 의존관계 개선과 조회 쿼리 개선 관련 내용을 확인하고 싶다면 아래의 포스트를 확인하길 바란다.</p>
<p><a href="https://seongwon.dev/Spring/20221009-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B01/">모모팀 서비스 성능 개선기1 (의존관계 개선)</a></p>
<p><a href="https://seongwon.dev/Spring/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/">모모팀 서비스 성능 개선기2 (조회 쿼리 개선)</a></p>
</blockquote>
<h1 id="객체-및-테이블의-연관관계" style="position:relative;"><a href="#%EA%B0%9D%EC%B2%B4-%EB%B0%8F-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84" aria-label="객체 및 테이블의 연관관계 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>객체 및 테이블의 연관관계</h1>
<p>모두모여라 서비스는 모임 서비스인만큼 모임(Group)객체/테이블을 중심으로 다른 객체/테이블들이 연관관계를 맺고 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVQoz32Tya6CUAyGef8HMT4BG1cu1IUbNwSVKHFAnFFm4tCbrwnkYMht0pTT0/792x4s6ZDv96v2fr9LFEVSFIVqmqZyPp/l/X634kyxuoCw6O12kziOZTgcymg0ksPhIHmeq8+M6wT8BUNOp5MCwGq328nj8VDG+P4FNMEQEq7Xq7xeLwU9Ho+y2WwU7HK5SJIk8vl8pCu3xdCcHYoAut/vxfM8PQMUhmEzx99ZWiYQFiDY1ckIzJhnHVdVlTIvy1ILmoRaS6HVxWLRqspmHcfRVk0mLAY/gBRuWgaEJGyWZar10HkqAK1WK2XJUvDVgPiez6cqncHYohXXdWU2m8l8Ptfhs1UuOfu+rzMMgkC/2TYFWdR6vdY7LCOguAU676vX60m/32+2CJvlcinT6VTG47EMBgOZTCYKAAkYceZ92ratoyLHgg1tErjdbpu/gbmYfwlKHEDcUZgu8LOkuu0/sPJKyIGbrk4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/b776f46678832847197207725150dc0b/c1b63/img.png"
        srcset="/static/b776f46678832847197207725150dc0b/5a46d/img.png 300w,
/static/b776f46678832847197207725150dc0b/0a47e/img.png 600w,
/static/b776f46678832847197207725150dc0b/c1b63/img.png 1200w,
/static/b776f46678832847197207725150dc0b/68638/img.png 1510w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 82.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVQ4y41U7XKiQBD0cQTkW0UQFVhEkaiHmqiX5Crv/xJzPbNSlTPe5X5M7bru9vT09NCzLIvuwzRN8jyfVnVD1XojazqbyfnX+wOyBgO94nfv/sIAf5qmQeFoTIfLGzW7A6nliuaL/GFiHQaZhvEYkMMw+hSOI2pfrgBbg2VNWa6+MHRdl3zfpyAIKAhDIdO7z2bbNoXhkEYAnKZTiqIJxXFCIzB2HEce8X3eN7uW9odnWm+21Gz3clcA+XGhSiqrlWimyiUlSSIPbQBwEj8IJVGX3AG7bXuk+ukHZcVSZIkmADRQu1rVdH77oKKEVllBuVoKOLNgMIcDe8/zsLrCkoNL7vbdXQFkoOPlXdYkndMCehVldSvRojiZ0gYlcYl1s4UUqbBkQJZiHEUUDsEeZxoQdE/Xd9rgQTrPBJBLYEALHcyqmo7XX7RudnKukKzf70slF1S2a0/SOGkKt1tVazqcXxFvokmJ3xz2rQzuooducgIXZXNnmUg6X4jmLNMMewEUDWGN9vknZcjIDLOiFBa2rbvKoF1zOO7t0+koPmTAHFn2p7Nk6kIttYb8+PODz9Z5FD0eGxY0DLUtJmj9cDSCBWJhc//gW0DfD2RuWWShj2B7dJrp8sz/B2QxF1lOeaGEZacPe4+B2Rq86hk3vwc8ortVvUW3GppgxAwZcpNyWOWAWd487fVYQYIhPMcd/huYAJ5eP2DaVjw1iWP95QATBaD98QXnlTSIddXNsf8NmGGGOXuSzuSL0ZXsuuxBbRXnNmKPv4d/xm90TCU+974fFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/fc70e3e16b643be3e3aa1c72ec937379/c1b63/img_1.png"
        srcset="/static/fc70e3e16b643be3e3aa1c72ec937379/5a46d/img_1.png 300w,
/static/fc70e3e16b643be3e3aa1c72ec937379/0a47e/img_1.png 600w,
/static/fc70e3e16b643be3e3aa1c72ec937379/c1b63/img_1.png 1200w,
/static/fc70e3e16b643be3e3aa1c72ec937379/68638/img_1.png 1510w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>실제로 객체의 연관관계를 나타낸 이미지와 DB 테이블의 다이어그램을 살펴보면 Group이 Member, Schedule, Participant와 연관관계를 맺고 있는 것을 확인할 수 있다.</p>
<h1 id="개선-전-쿼리-분석" style="position:relative;"><a href="#%EA%B0%9C%EC%84%A0-%EC%A0%84-%EC%BF%BC%EB%A6%AC-%EB%B6%84%EC%84%9D" aria-label="개선 전 쿼리 분석 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>개선 전 쿼리 분석</h1>
<p>모임 관련 CUD로직을 개선하기 앞서 개선 전 API별 쿼리를 분석한 결과는 아래와 같다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 129.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAACg0lEQVRIx6WVC5OiMBCE+f+/71YFFJS3giDg+zWXLy4usOhZdalKRSF0pqd7Jobve2KaE6nrWhj3+/05GbvdTuZzV7zFQjxvIUVRDO5rfhuXy0VOp5PcbrfBjefzWYLAF2c2E9/3Ze66z3fNaH9j9F/0fwPouo7YtiVRFOp1vV7Lfr+X7bbW79ujA9g/jQmD1WolcRTJcplIHEcSqEiTJJEoDKUsN90IoTObTWWxmItlmbL5zlGTgsPhoIGYYRhIEsfyLgiD/PER6/F4lOv12qHMc4SbTm0tjuPM9LM20FvK/Y3kCHWnti2+52k2dV11Du1E2M9Ze1MDSIQAER2pwUpD+f44wlAlfzwe6RwDCDgKD303GGEbEJXDIJDJZKxoWzpaJtFGSvmqqpSNMr1PRzgE0qeMVagmhMGTRIhAo9GXWKapI+cQvPnWhw1glqZif9MFFHPjTVxBPnEJK+obZVlKlmVqw1I9OGogPMjkN882m43k+VpyVSFFkSugw9Ne/WFkWapLCtNyYl8UnnnKLlB1HUevr6rqVy33vdWIwoHkCbp4MkniX/ueEcKdeoR/m+4P5ZMuR5SETZ7nWtnH+1tnP1NTfii0GxSFhNMMiKzpix9TfmUbfIhtUJccpkr1PtUn5Udz2OtcNZQbKvwHsFQq44I0XemODe3mPXvb00BdV7m+KaU+ZcxKhPQ+aNMg/psylULp0f6xDnl9CfjqsukDjr7+6Agpu0JRfjU+AqSrU3pESFPgAPLINRCrDp6qMqQUB2t5qH2x2VSUoatr2bK0uWm0lGVVlVo4quqfgJfLgzJAusmq65QVMVEe4O12+/kV8LhT/B9ARZlIiJyV2ViO+RdTodyKwTMWOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/b270be532c724342ff34def5d9bbeb4e/a9b70/img_2.png"
        srcset="/static/b270be532c724342ff34def5d9bbeb4e/5a46d/img_2.png 300w,
/static/b270be532c724342ff34def5d9bbeb4e/a9b70/img_2.png 479w"
        sizes="(max-width: 479px) 100vw, 479px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>요청별 실행되는 쿼리를 보면 셀 수도 없이 많은 쿼리들이 실행되는 것을 확인할 수 있다. 실제로 너무 많은 쿼리가 실행되어 쿼리를 분석하는 과정에서 각각의 쿼리가 왜 나가는지 이해 못하는 쿼리들이 존재하여 분석에 어려움을 느끼기도 하였다.</p>
<p>지금부터 문제가 많은 서비스의 CUD기능들의 쿼리를 어떻게 개선하였는지 자세히 살펴보겠다.</p>
<h1 id="group과-scheduleonetomany-단방향-관계의-문제점" style="position:relative;"><a href="#group%EA%B3%BC-scheduleonetomany-%EB%8B%A8%EB%B0%A9%ED%96%A5-%EA%B4%80%EA%B3%84%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90" aria-label="group과 scheduleonetomany 단방향 관계의 문제점 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Group과 Schedule..OneToMany 단방향 관계의 문제점</h1>
<p>기존 코드에서는 Group과 Schedule은 1:N 단방향 관계로 Group은 Schedule의 존재를 알지만 Schedule은 Group의 존재를 알지 못하였다. 하지만 DB 테이블 상에서는 반대로 Schedule이 외래키로 Group의 id를 갖고 Group은 Schdeule의 정보를 알지 못하였다. 이와 같이 객체지향 코드와 데이터베이스 상에서 불일치가 존재하더라도 JPA는 <code>@JoinColumn</code>과 같은 어노테이션들을 잘 설정해주면 DB에 올바른 테이블을 만들고 자동으로 매핑까지 해준다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 508px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9UlEQVQoz42T6XLaQBCEeRYkIWwKg3Xft4QQV8BxKnn/B+n0DCGJU6lKfnStQLvf9vSMZovFAv+j7XYL13EQJwnqbkDbj6jbHt1ujyiO4bquava3w7Ztf3y2TPhFhW46YXe4oKhbZEWNvGpRNj2KqkaWlwQnArT10J96wGx7CdM0UdLN9OldFaUFHM+H64dwvQBeECHOCkRJipnF203TgGncZcznMIy5AgWk7/l/Tlfj6UrdkJWtwvwwRhAlqoTAWIBhFKPkZsmlrBtmMqEd9liv13jZbOkkwNPzCmlZq7vj7SuaYVKYOBNYlGSMoGLJBFYEHa7vqNoBOQ+VdaeBu65H4AbbVwcbrt04YXe8qvrprEBxKVB5FmAoGVYMVTa14xEhb3JcH3GaY8OuLiwLNkt/Wi7R8JLx/KYly9pPFyR5pe5SNqSgGXWYNAN2Fwn7M4Mf4PFWuU3KtQTIxhg/MtxfCDzfWNEXLV9M5GWjwPwBDJlZT5iUHPOFZCKZ/g6U5hRNp7Ca+ZbtTt1JvrL/F5Ale56DIAiwftncM9u+chR8PK9WH4BZ1airbn/SzAT2aExIZ1J6SPjMNC098BhkgYg+DDbHyu326N++YTzcs/s5MoTJKjHFafbvL2Vh3+cxyFKOVqvOpIKAQD+M2GkONpUQFvD3dw4siG4h5yp2AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/f8fe27527fbbd676e4d4c490682ab1ab/2fd48/img_3.png"
        srcset="/static/f8fe27527fbbd676e4d4c490682ab1ab/5a46d/img_3.png 300w,
/static/f8fe27527fbbd676e4d4c490682ab1ab/2fd48/img_3.png 508w"
        sizes="(max-width: 508px) 100vw, 508px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>하지만 이러한 OneToMany 단방향 구조는 개발자가 의도하지 않은 쿼리를 발생시킨다는 문제가 존재한다. 문제에대해 더욱 자세히 살펴보겠다.</p>
<p>기존 로직에서는 모임을 만들고 일정 데이터인 Schedule을 객체지향적으로 프로그래밍하며 Java의 컬렉션에 데이터를 넣는 것처럼 Group객체를 만들 때 생성자를 통해 주입하도록 작성하였다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Getter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">NoArgsConstructor</span><span class="mtk4">(</span><span class="mtk7">access</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">AccessLevel</span><span class="mtk1">.</span><span class="mtk4">PROTECTED)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Entity</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">Group</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Id</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">GeneratedValue</span><span class="mtk4">(</span><span class="mtk7">strategy</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">GenerationType</span><span class="mtk1">.</span><span class="mtk4">IDENTITY)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk11">Long</span><span class="mtk4"> id</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">OneToMany</span><span class="mtk4">(</span><span class="mtk7">orphanRemoval</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">cascade</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">CascadeType</span><span class="mtk1">.</span><span class="mtk4">PERSIST)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">JoinColumn</span><span class="mtk4">(</span><span class="mtk7">name</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;group_id&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt;</span><span class="mtk4"> schedules </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk9">new</span><span class="mtk4"> </span><span class="mtk11">ArrayList</span><span class="mtk1">&lt;&gt;</span><span class="mtk4">()</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> Group</span><span class="mtk1">(</span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">schedules</span><span class="mtk1">, ...)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">schedules</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> schedules;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<blockquote>
<p>📌 실제 코드는 일급 컬렉션과 값 객체들로 이루어져있어 위의 코드는 독자들의 이해를 돕고자 필요한 부분을 추출하여 코드로 표현했습니다.</p>
</blockquote>
<p>위와 같이 코드를 작성한 이유는 객체지향적인 코드를 생각하였을 때 해당 코드와 같은 방식이 올바르다고 생각했기 때문이다. 그리고 데이터 저장에 대한 결과를 봤을 때 <code>ScheduleRepository</code>에 접근하여 직접 데이터를 추가하지 않아도 JPA는 Schedule 테이블에 일정 데이터를 저장해줬기에 괜찮은 방법이라 생각했다.</p>
<p>하지만 1:N 단방향 관계에서 연관관계 주인이 1이 되는 방법은 생성 로직을 수행해보면 치명적인 단점을 발견할 수 있다. 일반적으로 일정을 담은 모임 생성을 할 때 우리는 모임 insert, 일정 insert 이렇게 두 종류의 쿼리가 실행되는 것을 예상할 것이다. 실제로 실행되는 쿼리는 어떨까..? 테스트를 진행해본 결과 우리의 예상과는 너무나도 다른 쿼리가 실행된 것을 확인할 수 있었다. 실행된 쿼리는 아래와 같다.</p>
<pre class="grvsc-container one-dark-pro" data-language="sql" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_group</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, deadline, endDate, startDate, category, closedEarly, </span><span class="mtk9">description</span><span class="mtk1">, locationAddress, locationBuildingName, locationDetail, </span><span class="mtk9">name</span><span class="mtk1">, capacity, </span><span class="mtk8">host_id</span><span class="mtk1">) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span></code></pre>
<p>모임과 일정을 Insert하는 쿼리까지는 예상했던 쿼리라 문제가 없었다. 하지만 그 이후에 나오는 Update쿼리는 도대체 왜 나온 것일까?? 해당 쿼리가 실행되는 이유는 JPA에서 Schedule을 처음 DB에 저장할 때 GroupId를 모르기 때문에 Group의 Id없이 Schedule의 데이터가 먼저 저장되고 그 후에 비어있는 Schedule의 GroupId 컬럼 데이터를 채워주기 위해 Update쿼리가 날리기 때문이다.</p>
<p>생성에서도 문제가 발생하지만 삭제할 때도 우리의 예상과 다른 쿼리들이 발생한다. 모임 삭제 요청을 하였을 때 실행되는 쿼리는 아래와 같다.</p>
<pre class="grvsc-container one-dark-pro" data-language="sql" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_favorite </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">select</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">group_id</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> group_id5_4_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">id</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> id1_4_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">id</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> id1_4_1_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">date</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> date2_4_1_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">endTime</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> endtime3_4_1_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">startTime</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> starttim4_4_1_ </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule value0_ </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">value0_</span><span class="mtk1">.</span><span class="mtk7">group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk9">null</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_group </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span></code></pre>
<p>생성에 이어 삭제를 할 때도 일반적으로 예상되는 쿼리는 Delete Group과 Delete Schedule 쿼리가 발생되어야 하는데 중간에 Schedule의 GroupId를 <code>null</code>로 변환하는 예상하지 못한 쿼리가 발생하였다. 해당 쿼리도 바로 1:N 단방향 관계에서 나오는 문제점이었다.</p>
<blockquote>
<p>Schedule 유무에 대한 조회 쿼리와 Schedule을 직접 삭제하는 쿼리는 <code>orphanRemoval</code>옵션을 활성화시켜서 실행된 쿼리이다. 해당 옵션을 실행하지 않으면 해당 쿼리들은 발생하지 않을 것이다.</p>
</blockquote>
<p>해당 문제는 1:N 단방향 관계를 양방향 관계로 수정하며 해결할 수 있다. 양방향 연관관계는 서로를 의존하게되어 신경써야 할 부분이 많아 가급적 사용하지 않는 것이 좋다. 하지만 해당 부분에 대해서는 단방향 관계를 걸게 된다면 개발자들이 예상하지 못한 쿼리를 발생시켜 개발에 혼란을 줄 수 있기에 양방향 관계를 걸어주는 것이 좋다.</p>
<blockquote>
<p>양방향 관계는 ‘하면 안되는 것’이 아닌 ‘위험하여 주의해야하는 것’이다. 무조건 피하기보다 필요에 따라 양방향 연관관계를 만들기도 해야한다.</p>
</blockquote>
<blockquote>
<p>1:N 연관관계에 대해 자세히 알고 싶다면 아래의 포스트를 참고하길 바란다.</p>
<p><a href="https://seongwon.dev/Spring/20220824-JPA-%EC%97%94%ED%8B%B0%ED%8B%B0%EA%B0%84_%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84/#52-%EC%9D%BC%EB%8C%80%EB%8B%A4-1n">[JPA] 엔티티간 연관관계</a></p>
</blockquote>
<p>모임과 일정의 관계를 단방향에서 양방향으로 변경하는 과정을 진행한 후, 모임 생성 요청에서 실행된 쿼리를 확인해본 결과 초기에 우리가 예상했던 쿼리들만이 실행되는 것을 확인할 수 있었다.</p>
<pre class="grvsc-container one-dark-pro" data-language="sql" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">select</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">id</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> id1_2_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">deleted</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> deleted2_2_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">password</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> password3_2_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">user_id</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> user_id4_2_0_,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">name</span><span class="mtk1"> </span><span class="mtk9">as</span><span class="mtk1"> name5_2_0_ </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_member member0_ </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">member0_</span><span class="mtk1">.</span><span class="mtk7">id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_group</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, deadline, endDate, startDate, category, closedEarly, </span><span class="mtk9">description</span><span class="mtk1">, locationAddress, locationBuildingName, locationDetail, </span><span class="mtk9">name</span><span class="mtk1">, capacity, </span><span class="mtk8">host_id</span><span class="mtk1">) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, group_id, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, group_id, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?, ?)</span></span></span></code></pre>
<p>🤓 1:N 단방향을 양방향으로 변경하는 과정에서 JPA에게 위임하였던 Schedule 데이터의 저장을 위해<code>ScheduleRepository</code>가 만들어지고 저장 로직이 Service레이어까지 올라가는 객체지향과 멀어지는 변화가 있었다. 하지만 해당 변화를 거치며 예상하지 못한 쿼리가 사라지게 되어 유지보수 측면에서는 훨씬 개선되었다고 생각된다.</p>
<h1 id="orphanremoval에-의존적인-삭제-로직의-문제점" style="position:relative;"><a href="#orphanremoval%EC%97%90-%EC%9D%98%EC%A1%B4%EC%A0%81%EC%9D%B8-%EC%82%AD%EC%A0%9C-%EB%A1%9C%EC%A7%81%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90" aria-label="orphanremoval에 의존적인 삭제 로직의 문제점 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>orphanRemoval에 의존적인 삭제 로직의 문제점</h1>
<p>프로젝트를 진행하며 모모팀은 최대한 객체지향적인 코드를 작성하기 위해 orphanRemoval과 Cascade옵션을 활용하여 모임에 참여자 또는 일정이 추가되거나 빠졌을 때, 각각의 컬렉션에 데이터를 <code>add()</code>, <code>remove()</code> 메서드를 통해 데이터의 Insert, Delete가 이루어지도록 하였다.</p>
<p>기존에 모임을 삭제하였을 때 participant와 schedule 데이터들의 삭제도 <code>orphanRemoval</code>을 통해 삭제되도록 진행하였었다. 하지만 쿼리 분석을 하며 해당 부분에 대해서도 예상하지 못한 쿼리가 발생한 것을 확인하였다. 모임 삭제를 하였을 때 실행되는 쿼리 중에 Schedule과 Participant의 삭제 쿼리에 대해 자세히 살펴보겠다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 940px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 112.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQ4y6VU7XKbMBD0s7QTIyRAfIhvYxy7TsdN0mn6/u+y3cOEEDeTYvfHzhmZWW5vb7U6dS06G6DWCk2gURsfrdTQYG885DxXxsBoDSP1H1gZG6O/v0e73aJq2gGuKBBlDlUUoiChzxcDcyYMPsFAGFqLPQl3fY+mrtF1HYo8h2JHue8hI+EXbbDm8yvuRqxnVaCJgfBw2GO326EnqRDKBzbsuLYhjhzBSxzhxG6/E0/2jBdCzn6yPrL+IGLp0GYZKnaWl+UZlOvYYZIXqPlSww6LIEAeGGREPqIcazE7E9mrpiywrUo0uZsQax9GKdSU7Eh4R8k+5agZvItn9Sr5qa1wSC22dHVHt7uALhs11VBeHAa+0OXU5ag3G9Tthu5SclUho1ybpJD56nFd9AKygTCOLb4dDng4HtHTCDGn4wfEaflPT/u3sEPnaAq7qkfkJKppUkFzkiSZES7sUOQ5upuKs87BcQRCpGjKJHcc+CLCU13imCWDMUfCxfHg6NtLyzscXN62DXIbwXKPNtpD6it45rwmn0Fd1FcFq5gyC0pOKLnipZBxByP+kRJ2RDI+p+NvgSx5MjubOpTLIOZ6rD2FkktcMWoSqd+M1EMU4HGM2fMschK1X/YcO6kSyWAi5P5Zzs1EEUqSSYfqwgh9kQb1geS3Dim1Y/xKro+kQwj90Yxr3J1m+Nw16COGff0VDbMbDETXufvO5bJphv2zKaNG6ddG7a89lEQMMaMxEec4SdT6NkK5UMMwhOd58H3/3Txu7lDy6yj7lux+cDk4ZLy1pcuAN/P/Ev4BWr7ExPhHYdwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/8194551ef4a122b8878190e9cd5f0998/f79fa/img_4.png"
        srcset="/static/8194551ef4a122b8878190e9cd5f0998/5a46d/img_4.png 300w,
/static/8194551ef4a122b8878190e9cd5f0998/0a47e/img_4.png 600w,
/static/8194551ef4a122b8878190e9cd5f0998/f79fa/img_4.png 940w"
        sizes="(max-width: 940px) 100vw, 940px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>위의 쿼리들을 살펴보면 연관된 일정과 참여자 데이터가 존재하는지를 확인하는 조회 쿼리와 각각의 데이터들을 삭제하는 N개의 쿼리가 발생하는 것을 확인할 수 있다. 개인적으로 고아객체들이 존재하는지의 조회 쿼리는 쓰레기 데이터를 남기지 않기 위해 양보할 수 있는 쿼리라 생각한다. 하지만 삭제된 모임과 연관된 N개의 데이터들을 각각 Delete쿼리를 개별로 실행하여 삭제하는 것은 큰 문제가 있다고 생각되어 이를 Service레이어에서 GroupId를 통해 연관된 Schedule과 Participant데이터를 모두 삭제하는 방식으로 코드를 수정하였다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">GroupModifyService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk5 mtki">// 기존 코드</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> delete</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">hostId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">ifMemberIsHost</span><span class="mtk1">(hostId, groupId, (host, group) </span><span class="mtk9">-&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">validateGroupIsProceeding</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">applicationEventPublisher</span><span class="mtk1">.</span><span class="mtk3">publishEvent</span><span class="mtk1">(</span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">GroupDeleteEvent</span><span class="mtk1">(groupId));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">groupRepository</span><span class="mtk1">.</span><span class="mtk3">deleteById</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk5 mtki">// 변경 후 코드</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> delete</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">hostId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">ifMemberIsHost</span><span class="mtk1">(hostId, groupId, (host, group) </span><span class="mtk9">-&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">validateGroupIsProceeding</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">applicationEventPublisher</span><span class="mtk1">.</span><span class="mtk3">publishEvent</span><span class="mtk1">(</span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">GroupDeleteEvent</span><span class="mtk1">(groupId));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">scheduleRepository</span><span class="mtk1">.</span><span class="mtk3">deleteAllByGroupId</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">participantRepository</span><span class="mtk1">.</span><span class="mtk3">deleteAllByGroupId</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">groupRepository</span><span class="mtk1">.</span><span class="mtk3">deleteById</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>기존에는 모임 삭제를 할 때, 단순히 <code>groupRepository.deleteById(groupId);</code> 만을 실행시켰던 로직을 <code>scheduleRepository</code>와 <code>participantRepository</code>의 <code>deleteAllByGroupId();</code> 를 각각 실행시키도록 수정한 결과 아래와 같이 모임 삭제를 요청하였을 때 발생하는 N개의 쿼리들을 모두 제거할 수 있었다.</p>
<pre class="grvsc-container one-dark-pro" data-language="sql" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_favorite </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_participant </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_group </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span></code></pre>
<h1 id="모임-수정-로직의-문제점" style="position:relative;"><a href="#%EB%AA%A8%EC%9E%84-%EC%88%98%EC%A0%95-%EB%A1%9C%EC%A7%81%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90" aria-label="모임 수정 로직의 문제점 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>모임 수정 로직의 문제점</h1>
<p>모모팀 서비스 쿼리 분석을 하며 가장 문제가 많았던 API는 바로 모임 정보 업데이트이다. JPA는 트랜잭션 안에서 처음 엔티티 데이터를 읽어왔을 때와 트랜잭션이 끝나서 entityManager가 flush될 때 객체의 변화가 생기면 Dirty Checking을 하여 변경된 데이터에 대해 Update쿼리를 날려준다. 그렇기에 업데이트 로직을 살펴보면 Schedule을 제외한 다른 모임 정보 데이터들은 객체의 값을 재할당하는 과정만을 진행하고 있었다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">NoArgsConstructor</span><span class="mtk4">(</span><span class="mtk7">access</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">AccessLevel</span><span class="mtk1">.</span><span class="mtk4">PROTECTED)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Entity</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">Group</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> update</span><span class="mtk1">(</span><span class="mtk11">Capacity</span><span class="mtk1"> </span><span class="mtk4 mtki">capacity</span><span class="mtk1">, </span><span class="mtk11">Calendar</span><span class="mtk1"> </span><span class="mtk4 mtki">calendar</span><span class="mtk1">, </span><span class="mtk11">GroupName</span><span class="mtk1"> </span><span class="mtk4 mtki">name</span><span class="mtk1">, </span><span class="mtk11">Category</span><span class="mtk1"> </span><span class="mtk4 mtki">category</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                       </span><span class="mtk11">Location</span><span class="mtk1"> </span><span class="mtk4 mtki">location</span><span class="mtk1">, </span><span class="mtk11">Description</span><span class="mtk1"> </span><span class="mtk4 mtki">description</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">validateGroupIsProceeding</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk11">participants</span><span class="mtk1">.</span><span class="mtk3">updateCapacity</span><span class="mtk1">(capacity);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk11">calendar</span><span class="mtk1">.</span><span class="mtk3">update</span><span class="mtk1">(</span><span class="mtk11">calendar</span><span class="mtk1">.</span><span class="mtk3">getDeadline</span><span class="mtk1">(), </span><span class="mtk11">calendar</span><span class="mtk1">.</span><span class="mtk3">getDuration</span><span class="mtk1">(), </span><span class="mtk11">calendar</span><span class="mtk1">.</span><span class="mtk3">getSchedules</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">name</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> name;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">category</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> category;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">location</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> location;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">description</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> description;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Schedule의 경우 <code>final</code>로 재할당이 막힌 <code>List</code>이기에 재할당이 아닌 <code>clear()</code>를 통한 초기화와 <code>addAll()</code>을 통한 데이터 추가를 진행하였다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Getter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">NoArgsConstructor</span><span class="mtk4">(</span><span class="mtk7">access</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">AccessLevel</span><span class="mtk1">.</span><span class="mtk4">PROTECTED)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Embeddable</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">Schedules</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">OneToMany</span><span class="mtk4">(</span><span class="mtk7">orphanRemoval</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">cascade</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">CascadeType</span><span class="mtk1">.</span><span class="mtk4">PERSIST)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">JoinColumn</span><span class="mtk4">(</span><span class="mtk7">name</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;group_id&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt;</span><span class="mtk4"> value </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk9">new</span><span class="mtk4"> </span><span class="mtk11">ArrayList</span><span class="mtk1">&lt;&gt;</span><span class="mtk4">()</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> Schedules</span><span class="mtk1">(</span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">schedules</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">value</span><span class="mtk1">.</span><span class="mtk3">addAll</span><span class="mtk1">(schedules);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> change</span><span class="mtk1">(</span><span class="mtk11">Schedules</span><span class="mtk1"> </span><span class="mtk4 mtki">schedules</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">value</span><span class="mtk1">.</span><span class="mtk3">clear</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">value</span><span class="mtk1">.</span><span class="mtk3">addAll</span><span class="mtk1">(</span><span class="mtk11">schedules</span><span class="mtk1">.</span><span class="mtk4">value</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><code>clear()</code>과 <code>addAll()</code>과정을 거쳤을 때 Schedule도 다른 데이터들처럼 Dirty Checking을 하며 기존에 없던 일정에 대해서만 업데이트 쿼리를 날려주면 좋을 텐데 실제 동작은 그렇지 못한다. Schedule은 별도의 테이블에 저장되어 id값을 할당받기에 같은 일정에 대해서도 id값의 유뮤 차이가 발생하여 JPA는 다른 객체로 인지한다. 그 결과 기존 데이터를 삭제하는 Delete쿼리와 새로운 데이터를 추가하는 Insert쿼리를 날리게 된다.</p>
<p>이러한 동작은 모모팀의 업데이트 요청 처리 성능상에 큰 저하를 불러일으켰다. 일정 변경의 유무와 상관없이 <code>List&#x3C;Schedule></code>을 <code>clear()</code>, <code>addAll()</code> 을 진행하다보니 매번 불필요한 Schedule Delete, Update쿼리가 발생하게 되었다. 실제로 2개의 일정이 있는 모임에 같은 일정을 담아 요청을 보낼 경우, 실제 일정 값에는 변화가 없지만 해당 데이터를 새로 추가하고 기존의 데이터를 삭제하는 쿼리들이 실행되는 것을 확인할 수 있다.</p>
<pre class="grvsc-container one-dark-pro" data-language="sql" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">insert</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">into</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (id, </span><span class="mtk9">date</span><span class="mtk1">, endTime, startTime) </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">values</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (default, ?, ?, ?)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk9">null</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">and</span><span class="mtk1"> id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk9">null</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">and</span><span class="mtk1"> id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">update</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">set</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        group_id</span><span class="mtk8">=</span><span class="mtk1">? </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Hibernate: </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">delete</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">from</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        momo_schedule </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9">where</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        id</span><span class="mtk8">=</span><span class="mtk1">?</span></span></span></code></pre>
<blockquote>
<p>groupId를 null로 변경하는 update 쿼리는 <code>orphanRemoval</code>이 있어서 발생한 쿼리이다.</p>
</blockquote>
<p>이를 개선하기 위해 id를 제외한 일정 값만을 비교하여 변경점에 대해서만 데이터를 추가,삭제하는 Dirty Checking 로직을 직접 구현하였다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">GroupModifyService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> update</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">hostId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">GroupRequest</span><span class="mtk1"> </span><span class="mtk4 mtki">request</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">ifMemberIsHost</span><span class="mtk1">(hostId, groupId, (host, group) </span><span class="mtk9">-&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">updateGroup</span><span class="mtk1">(group, request);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">updateSchedules</span><span class="mtk1">(group, </span><span class="mtk11">request</span><span class="mtk1">.</span><span class="mtk3">getSchedules</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">	</span><span class="mtk9">private</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> updateSchedules</span><span class="mtk1">(</span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4 mtki">group</span><span class="mtk1">, </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">newSchedules</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4">presentSchedules</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">getSchedules</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4">toBeDeletedSchedules</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">presentSchedules</span><span class="mtk1">.</span><span class="mtk3">stream</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">filter</span><span class="mtk1">(schedule </span><span class="mtk9">-&gt;</span><span class="mtk1"> </span><span class="mtk3">notContainSchedules</span><span class="mtk1">(newSchedules, schedule))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">collect</span><span class="mtk1">(</span><span class="mtk11">Collectors</span><span class="mtk1">.</span><span class="mtk3">toList</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4">toBeSavedSchedules</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">newSchedules</span><span class="mtk1">.</span><span class="mtk3">stream</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">filter</span><span class="mtk1">(schedule </span><span class="mtk9">-&gt;</span><span class="mtk1"> </span><span class="mtk3">notContainSchedules</span><span class="mtk1">(presentSchedules, schedule))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">collect</span><span class="mtk1">(</span><span class="mtk11">Collectors</span><span class="mtk1">.</span><span class="mtk3">toList</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">reflectSchedules</span><span class="mtk1">(group, toBeDeletedSchedules, toBeSavedSchedules);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk3"> </span><span class="mtk9">boolean</span><span class="mtk3"> notContainSchedules</span><span class="mtk1">(</span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">schedules</span><span class="mtk1">, </span><span class="mtk11">Schedule</span><span class="mtk1"> </span><span class="mtk4 mtki">schedule</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk11">schedules</span><span class="mtk1">.</span><span class="mtk3">stream</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">noneMatch</span><span class="mtk1">(schedule</span><span class="mtk9">::</span><span class="mtk1">equalsDateTime);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> reflectSchedules</span><span class="mtk1">(</span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4 mtki">group</span><span class="mtk1">, </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">toBeDeletedSchedules</span><span class="mtk1">, </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Schedule</span><span class="mtk1">&gt; </span><span class="mtk4 mtki">toBeSavedIds</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">toBeDeletedSchedules</span><span class="mtk1">.</span><span class="mtk3">isEmpty</span><span class="mtk1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">scheduleRepository</span><span class="mtk1">.</span><span class="mtk3">deleteAllInSchedules</span><span class="mtk1">(toBeDeletedSchedules);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">for</span><span class="mtk1"> (</span><span class="mtk11">Schedule</span><span class="mtk1"> </span><span class="mtk4">schedule</span><span class="mtk1"> </span><span class="mtk9">:</span><span class="mtk1"> toBeSavedIds) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">addSchedule</span><span class="mtk1">(schedule);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>update()메서드의 동작을 살펴보면 일정 정보를 업데이트하는 로직을 따로 분리한 것을 확인할 수 있다. 일정 정보 업데이트 부분을 분리하여 변경된 값에 대해서만 반영하도록 수정한 결과, 일정 변경의 유무와 관련없이 3N개의 쿼리가 발생하던 문제를 일정 변경이 발생하였을 때만 아래의 쿼리가 발생하도록 개선할 수 있었다.</p>
<ul>
<li>삭제된 일정이 있다면 삭제 쿼리 1 + 추가된 일정을 추가하는 쿼리 N</li>
</ul>
<h1 id="개선-전후-실행되는-쿼리-수-비교" style="position:relative;"><a href="#%EA%B0%9C%EC%84%A0-%EC%A0%84%ED%9B%84-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94-%EC%BF%BC%EB%A6%AC-%EC%88%98-%EB%B9%84%EA%B5%90" aria-label="개선 전후 실행되는 쿼리 수 비교 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>개선 전/후 실행되는 쿼리 수 비교</h1>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 717px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 97.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACE0lEQVQ4y32UCbOiMBCE+f//bt/bWq9V8cIDRC7BUnE237hJBfSZKgpNmOnumZ4EaZpKVVXyeDzcc7/fJcsySZJEyrLUvbZtzbt153mey9Gc92ODosilKAq3wSJgu41ktVpJmh6lvziPoo3M5zOJ44PuuYTyZsFmbZIRMJtN5Xg8KqPr9eqCUQDY6ZTq93Y/QPLhsDfPwQXcbjdJ4lg2m7Uc9nup61of9u15aVQBVJZFl+HlcnEBFqlt75psMhnLcrl4r2C9lt/fXxKGcwf0UfJut5XVcqm1omb+IhCpu91OZXcS+h3ym7JYhPL99Usm47GyvVwaDbQdB5A6Lw0ovykd621CAmJTU5pCMpIjjTeBAFZVqbY5mf9NUzv2QV+KTUjBSbAIQ5VW12cNtEwBCsMn0MbUEwCa+sLQZ/rTAjCKIhmPRzKd/lVQwM/n89M2FJ4/liWSkiQ2nVypnZ77rQPDBRg6z7MXsMCy6deQRCBrQ5qmUxJfQV9ZkGUndb2/qcY2BYc5TJ5z3J11y/AlIR/7Ab6xR6OhFh3z99lYC/X3tYafGDKWMPKBOSdm/9/YvvyAVvtD72poZpiLgaT9xXeYmQ5zzhXG6HZ8+Cp5o7OMubkAGtMYnMAbxowl54AOBn8kz7LupPQZch8OhwOt43w2k71hTCO4cFEEQxJiLeTbef9xUhg9zEpzuAu5hJmWT4v4fw9mv0MgIKkUAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/01b4fc0187e027fbd2732eef38310c8e/0ad97/img_5.png"
        srcset="/static/01b4fc0187e027fbd2732eef38310c8e/5a46d/img_5.png 300w,
/static/01b4fc0187e027fbd2732eef38310c8e/0a47e/img_5.png 600w,
/static/01b4fc0187e027fbd2732eef38310c8e/0ad97/img_5.png 717w"
        sizes="(max-width: 717px) 100vw, 717px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h1 id="마치며" style="position:relative;"><a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-label="마치며 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>마치며</h1>
<p>이로써 모모팀의 쿼리 분석 및 개선 작업이 끝이 났다. 쿼리 개선 과정을 진행하며 성능 개선을 위해 많은 고민을 하고 많은 트러블 슈팅이 존재하여 힘들었지만 실행되는 쿼리를 대폭 줄일 수 있어서 보람찼다.</p>
<p>이제 개선된 코드를 통해 다시 성능 테스트를 진행해보며 개선 전/후를 비교해보고자 한다. 테스트 결과는 다음 포스팅을 통해 확인해보겠다.</p>
<blockquote>
<p>코드 변경에 대한 자세한 내용은 아래의 PR과 모모 레포지토리를 통해 확인하실 수 있습니다.
코드 변경에 대한 자세한 내용은 아래의 PR과 모모 레포지토리를 통해 확인하실 수 있습니다.</p>
<ul>
<li><a href="https://github.com/woowacourse-teams/2022-momo">woowacourse-teams/2022-momo</a></li>
<li><a href="https://github.com/woowacourse-teams/2022-momo/pull/446">woowacourse-teams/2022-momo/pull/446</a></li>
</ul>
</blockquote>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .one-dark-pro {
    background-color: #282c34;
    color: #abb2bf;
  }
  .one-dark-pro .mtki { font-style: italic; }
  .one-dark-pro .mtk1 { color: #ABB2BF; }
  .one-dark-pro .mtk11 { color: #E5C07B; }
  .one-dark-pro .mtk4 { color: #E06C75; }
  .one-dark-pro .mtk7 { color: #D19A66; }
  .one-dark-pro .mtk8 { color: #56B6C2; }
  .one-dark-pro .mtk9 { color: #C678DD; }
  .one-dark-pro .mtk6 { color: #98C379; }
  .one-dark-pro .mtk3 { color: #61AFEF; }
  .one-dark-pro .mtk5 { color: #7F848E; }
  .one-dark-pro .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div><div class="css-1bdwg0l e6qprj20"><div><style data-emotion-css="17t5ffy">.css-17t5ffy{margin-top:1rem;margin-bottom:1rem;}</style><div class="css-17t5ffy"><div class="css-1l4w6pd"><div class="css-164tafw"></div></div></div><style data-emotion-css="i1cgbm">.css-i1cgbm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;margin-top:1rem;padding-left:0.5rem;padding-right:0.5rem;}</style><div class="css-i1cgbm"><style data-emotion-css="16k19ub">.css-16k19ub{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#2D87FD;}</style><button class="css-16k19ub"><style data-emotion-css="u7tj59">.css-u7tj59{fill:currentColor;margin-top:auto;margin-bottom:auto;margin-right:0.25rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg>Share with <!-- -->Facebook</button><style data-emotion-css="9nr5sz">.css-9nr5sz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#1CA1F2;}</style><button class="css-9nr5sz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>Share with <!-- -->Twitter</button><style data-emotion-css="rk0yc0">.css-rk0yc0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#6E7783;}</style><button class="css-rk0yc0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg>Share with <!-- -->Url</button></div></div></div></div></div><div class="css-1bdwg0l e6qprj20"><style data-emotion-css="17t1oy1">.css-17t1oy1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap-reverse;-ms-flex-wrap:wrap-reverse;flex-wrap:wrap-reverse;margin-left:0.5rem;margin-right:0.5rem;margin-top:1rem;}@media (min-width:768px){.css-17t1oy1{-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}</style><div class="css-17t1oy1 e1ic15ss0"><style data-emotion-css="1pwr1ry">.css-1pwr1ry{width:100%;margin:0.5rem;}@media (min-width:768px){.css-1pwr1ry{width:50%;margin:1rem;}}</style><div class="css-1pwr1ry e1ic15ss1"><style data-emotion-css="txyanx">.css-txyanx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);text-align:left;width:100%;height:100%;padding:0.5rem;background-color:#eee;border-radius:0.25rem;border-left-width:4px;border-color:#A5CC82;}.css-txyanx:hover{background-color:#ddd;}</style><a rel="prev" class="css-txyanx" href="/Backend/20221014-모모팀-서비스성능-개선기2/"><style data-emotion-css="19o7xeo">.css-19o7xeo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;margin-right:1rem;margin-left:0.5rem;height:100%;}</style><div class="css-19o7xeo"><style data-emotion-css="11za1ik">.css-11za1ik{width:2rem;height:2rem;margin-top:auto;margin-bottom:auto;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-11za1ik" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 0 0 0 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"></path></svg></div><style data-emotion-css="v38or">.css-v38or{display:inline-block;margin-top:0.5rem;margin-bottom:0.5rem;}</style><div class="css-v38or"><style data-emotion-css="1e3im4j">.css-1e3im4j{color:#00467F;}</style><p class="css-1e3im4j">이전 포스트</p><p>모모팀 서비스 성능 개선기2 (조회 쿼리 개선)</p></div></a></div><div class="css-1pwr1ry e1ic15ss1"><style data-emotion-css="89mi30">.css-89mi30{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);text-align:right;width:100%;height:100%;padding:0.5rem;background-color:#eee;border-radius:0.25rem;border-right-width:4px;border-color:#A5CC82;}.css-89mi30:hover{background-color:#ddd;}</style><a rel="next" class="css-89mi30" href="/Backend/20221020-모모팀-서비스성능-개선결과/"><div class="css-v38or"><p class="css-1e3im4j">다음 포스트</p><p>모모팀 서비스 성능 개선 결과 (성능 테스트)</p></div><div class="css-19o7xeo"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-11za1ik" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 0 0 0-48.4z"></path></svg></div></a></div></div><style data-emotion-css="14yohw7">.css-14yohw7{width:100%;max-width:768px;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto;padding-top:2rem;margin-top:0.5rem;margin-bottom:1rem;}@media (min-width:768px){.css-14yohw7{padding-left:0;padding-right:0;padding-top:3rem;}}</style><div class="css-14yohw7 e1q36c7t0"><style data-emotion-css="180ky7f">.css-180ky7f{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:0.5rem;padding-right:0.5rem;}@media (min-width:768px){.css-180ky7f{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-180ky7f e1q36c7t1"><style data-emotion-css="p5b1u1">.css-p5b1u1{border-radius:9999px;border-width:1px;--border-opacity:1;border-color:rgba(214,188,250,var(--border-opacity));margin-right:2rem;margin-bottom:0.5rem;}@media (min-width:768px){.css-p5b1u1{margin-bottom:1rem;}}</style><div class="css-p5b1u1 gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:128px;height:128px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDklEQVQ4y31UXUhTYRg+F0VFSRmBms413dSyMvuhaGU5LCEQzUCcWxJpGeE/hNnwN+1nCKUyp3gRImFIXmRd5KYXYZLQSvBa8EaSpqRo29ymezrvmd/Z5pYvfOc7H+c9z/e8z/vDra+vg5bbTcu9+e7G2toatrONjQ04nU7Rn/3LhQJzuVzCT4uLi+joeA2NJh/XrquQkXEVmZkZaGlpFsDInM61AFCOHWgnINrJenq6ERF5CKfPpKCiohRNzQ2oq9fhfkkxko4qkJAYj8nJb5ugPqacPzMGVlx8F+HhYRgcfPffkGuf1GD3nh2YmPgaAMoxqiyEoqI7kEpjYLX+Fh1JT7YcDocoSeuzp5DFxQphezweX8gsAe3trxB+MAzz87+Es91uD9DWXxoGejIlGS2tzcI74XDsw8zMDPYf2IvRUbNwdjjsW4C8i4EyEn19b5B8PInPuscbMvtQ8uAesrJubII54Csnrxx0sb/4jMjc3BxiYiIxPT0tnDl6LC39gSQ2CibTZ1E3BkLa+BsDZszJLirPw2Do8AEODLzFseTEAFbMrFYrjEYDTOYRGLo6g4DJtLfVqKqu8AFWVZVDXZAnsiNWlCAKZ3l5CTWPH2F4+AO6e4xYXV3B2NiomASywkINSsse+gAL+E4o54uXZZYs91YOzp5LDao/5aULyM7JCvDVaPNR5g9IB61WLSaE7Upem8QkOerqdKiurkSsNBqX05Q862UhChYytWVbm94HODT0HvFyqdDw/iXhcjnxUv8cN3Ozka/OE9qRfFi45EugMpkEZrPJC0gOJLAiIQ6NjfWijqwOtxr5soIn0+tfQK6QCZcTFsdoU6Pv3bcLTU0NAQA2uw02G62/QSNNp6vl+3knX24jIpGA1rP8sEAiiRLq6uOnYSwsWIMYTk39FCKRK44IpWaxfA8eDv6gKysrqOTLiJqeFmU1PT0N6ao0nEo9gcPREVCprqC3t0eUhOkpji8GysJnN46Pf+GLugvG7i6+EzrR39+H2dnZbac2F2qS0I0sm6GMjbRQk+gfC+9ZnRl0IjIAAAAASUVORK5CYII=" alt="profileImg" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/1134414851454382d55f3e82eb460d40/2c344/profile.png 1x,
/static/1134414851454382d55f3e82eb460d40/f20a7/profile.png 1.5x" /><img loading="lazy" width="128" height="128" srcset="/static/1134414851454382d55f3e82eb460d40/2c344/profile.png 1x,
/static/1134414851454382d55f3e82eb460d40/f20a7/profile.png 1.5x" src="/static/1134414851454382d55f3e82eb460d40/2c344/profile.png" alt="profileImg" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div><span>Written by </span><style data-emotion-css="16q43sj">.css-16q43sj{display:inline-block;font-size:1.25rem;font-weight:700;border-radius:9999px;margin-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;--bg-opacity:1;background-color:rgba(237,242,247,var(--bg-opacity));color:#00467F;}</style><p class="css-16q43sj">@<!-- -->momo</p><style data-emotion-css="vg2p6i">.css-vg2p6i{font-size:0.875rem;font-weight:400;margin-bottom:0.5rem;}</style><div class="css-vg2p6i">모모팀의 기술 블로그입니다</div></div></div><style data-emotion-css="1air669">.css-1air669{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-1air669"><div class="css-164tafw"></div></div></div><style data-emotion-css="18jj1tc">.css-18jj1tc{margin-top:1.25rem;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-18jj1tc"><div class="utterances"></div></div></div></div><style data-emotion-css="xgi74q">.css-xgi74q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;bottom:0;right:0;padding-right:1.5rem;padding-bottom:1.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><div class="css-xgi74q e1m8uc5d0"><style data-emotion-css="1a68u">.css-1a68u{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-content:flex-end;-ms-flex-line-pack:end;align-content:flex-end;z-index:100;}.css-1a68u:hover{background-color:#404040;color:#FFFFFF;}.css-1a68u:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="change to darkmode" class="css-1a68u"><style data-emotion-css="1alqh2e">.css-1alqh2e{fill:currentColor;--text-opacity:1;color:rgba(246,224,94,var(--text-opacity));width:1rem;height:1rem;margin-top:auto;margin-bottom:auto;margin-left:0;margin-right:0;}@media (min-width:768px){.css-1alqh2e{display:inline-block;margin-left:0.25rem;margin-right:0.25rem;}}</style><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1alqh2e" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg><style data-emotion-css="flxr9x">.css-flxr9x{display:none;margin-right:0;}@media (min-width:768px){.css-flxr9x{display:inline-block;margin-right:0.25rem;}}</style><span class="css-flxr9x">다크 모드로 보기</span></button><style data-emotion-css="15afv4q">.css-15afv4q{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;margin-left:0.5rem;margin-top:auto;margin-bottom:auto;z-index:100;}.css-15afv4q:hover{background-color:#404040;color:#FFFFFF;}.css-15afv4q:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="top page" class="css-15afv4q"><style data-emotion-css="13htjwu">.css-13htjwu{width:1rem;height:1rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-13htjwu" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M868 545.5L536.1 163a31.96 31.96 0 0 0-48.3 0L156 545.5a7.97 7.97 0 0 0 6 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"></path></svg></button></div><style data-emotion-css="1k8xcyw">.css-1k8xcyw{text-align:center;padding-top:2rem;padding-bottom:2rem;bottom:0;}</style><footer class="css-1k8xcyw"><style data-emotion-css="1xju3od">.css-1xju3od{font-size:0.75rem;font-weight:700;}</style><a href="https://github.com/Seongwon97" class="css-1xju3od">©Momo</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-Y3VQCJ7ZEX', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/Backend/20221017-모모팀-서비스성능-개선기3/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2f72579fb641bf14a0fa.js"],"app":["/app-d1a6932a45bfd024ad29.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0a6852889ec28cc0cb78.js"],"component---src-pages-index-js":["/component---src-pages-index-js-df04c8a92b3d2d8d3fc9.js"],"component---src-pages-search-js":["/component---src-pages-search-js-9304c0011dcd53f925c6.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-4910a6c560d7a355cf37.js"],"component---src-templates-category-js":["/component---src-templates-category-js-00675ddb0659eb6056e0.js"]};/*]]>*/</script><script src="/polyfill-2f72579fb641bf14a0fa.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-4910a6c560d7a355cf37.js" async=""></script><script src="/7a297f752dcfe258c0b0106d89edb3a916af916e-ba3bed115b500439fc94.js" async=""></script><script src="/commons-b839ac3ef2817b5d267d.js" async=""></script><script src="/1bfc9850-409296e666dade882413.js" async=""></script><script src="/5e2a4920-da90abce4a08c86a094c.js" async=""></script><script src="/d7eeaac4-dcbe97e7a5aa158c9d08.js" async=""></script><script src="/app-d1a6932a45bfd024ad29.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-17eb047fb821ccbad0b0.js" async=""></script><script src="/styles-84a9bc99193fe5828ffe.js" async=""></script><script src="/framework-eb684e3e828ad13b3940.js" async=""></script><script src="/webpack-runtime-91d2ca5880d6e7d8e505.js" async=""></script></body></html>