{"componentChunkName":"component---src-templates-blog-post-js","path":"/Backend/20221014-모모팀-서비스성능-개선기2/","result":{"data":{"site":{"siteMetadata":{"author":"momo","comment":{"utterances":"2022-momo/2022-momo.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"excerpt":"들어가며 지금까지는 서비스 개발을 진행하며 API를 호출하였을 때 실행되는 쿼리의 수, 성능상의 문제점 등을 생각하지 않고 일단 돌아가는 코드를 만들자! 하면서 기능 개발에만 몰두하였었다. 하지만 성능상의 문제를 생각하지 않고 개발을 진행하고 우리 서비스의 목표 인원(우테코 크루 + 코치, 약 150명)이 동시 접속을 하여 서비스를 이용한다는 상황으로 부…","html":"<h1 id=\"들어가며\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\" aria-label=\"들어가며 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가며</h1>\n<p>지금까지는 서비스 개발을 진행하며 API를 호출하였을 때 실행되는 쿼리의 수, 성능상의 문제점 등을 생각하지 않고 일단 돌아가는 코드를 만들자! 하면서 기능 개발에만 몰두하였었다. 하지만 성능상의 문제를 생각하지 않고 개발을 진행하고 우리 서비스의 목표 인원(우테코 크루 + 코치, 약 150명)이 동시 접속을 하여 서비스를 이용한다는 상황으로 부하 테스트를 진행하였을 때 애플리케이션이 올라간 EC2가 버티지 못하는 문제가 발생하였다.</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/cb9a1190-ac7c-4dc2-99b1-da4e630133a8/Untitled.png\" alt=\"부하테스트 결과 Img\"></p>\n<p>실제로 부하를 준 후에 Grafana와 Prometheus를 통해 Spring 프로젝트를 모니터링 해본 결과 EC2가 종료되기 전에 많은 객체를 생성하여 메모리 사용량과 GC의 동작이 활발한 것을 확인할 수 있고 DB에 많은 조회요청이 있어 HikariCP의 DB 커넥션이 항상 높거나 부족한 것을 확인할 수 있었다.</p>\n<p>이에 서비스의 API별 실행되는 쿼리의 개수를 파악하여 개선해야한다는 것을 느꼈고 가장 많은 요청이 있는 조회 쿼리에 대한 개선을 먼저 진행해보려고 한다.</p>\n<h1 id=\"객체-및-테이블의-연관관계\" style=\"position:relative;\"><a href=\"#%EA%B0%9D%EC%B2%B4-%EB%B0%8F-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84\" aria-label=\"객체 및 테이블의 연관관계 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>객체 및 테이블의 연관관계</h1>\n<p>조회 로직 개선을 하기 앞서 먼저 객체와 테이블들 사이의 연관관계를 살펴보겠다. 모두모여라 서비스는 모임 서비스인만큼 모임(Group)객체/테이블을 중심으로 다른 객체/테이블들이 연관관계를 맺고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYklEQVQoz32Sya6CQBBF+/9/RP6AhUuIw8adGCPGgajgzOAs1suppAkY8yrpNNRw69atNvLDPp+P3ufzWY7Ho9xuNz15nst2u5X3+93Iq5v5BcTNORwOCuJ5nnQ6HVmv13K5XCTLskbeT8BvMAw21+tVkiSR5XIpp9NJWeP7F7AOhjEe7F6vl4IBbAF3u52y/h7b3g2Gde0AxChcrVYymUyqnDiOK8BvLY1NsgcwWGBlWTaWY+35fCpzbk6dUGMpj8dDxuNxoyt6DYdDbVJnUhSFBEGggDSuRkYviu73e/U8rOg02O/3Eoah6pemqcYtILKwcfzEwTA4R6ORDAYDvWezmbIBDN3m87lsNhvVbbFYSBRF2tD+oy8+/lmeQR9+Wq2WOI6j3xTQaDqdSq/Xk263K+12W3zfVwAawqrf7+sbdV1XZaHGEIQ+iXTkSSA4ujAG4FYGHjXLIUYdPisXoxP7A3zgSzqglAFmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/9d2e13f3727b2e5e26b7e70f12454fc4/c1b63/img.png\"\n        srcset=\"/static/9d2e13f3727b2e5e26b7e70f12454fc4/5a46d/img.png 300w,\n/static/9d2e13f3727b2e5e26b7e70f12454fc4/0a47e/img.png 600w,\n/static/9d2e13f3727b2e5e26b7e70f12454fc4/c1b63/img.png 1200w,\n/static/9d2e13f3727b2e5e26b7e70f12454fc4/a8a6f/img.png 1516w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACb0lEQVQ4y3VUWWKqQBD0QC9RI4uKu6hRQVCIiGuWt9z/BPWqG8doYj7aAWempqq6hlK1WsXT0xNkNCXvlUoFvV4P8SpBEC4QRjEajYb+b9bLeP0sY+knwHK5jFkY4fj+F9EyxSJeodXu3ABel/x/AbwGMvX4+Ih5tEJ+eMUsWGCVrtHudPSga1a1Wk3Lth2O1i1DWVyplGFZNcproj8YYDweo9vrwx+NVbI5UNZ2acl2f0K63iB52WARLQvAmmWh2+1iMnnGbB4iXEQEmqDZbKoUi/O2bcPzWrAdpzicCga+j/3rB+JkjTntCVgl2WA7Ljb7V+SsKQHFu3ARY0RQnSeYyHJcV5+NIsexlbXIlTm3Xi8AHZ6ak3q2O8EnyEiY0jd/REBKk/nn6UxlLZMX7bphLwfIfJ1gcmgBSPRsd8Tu9EGGBVBwZihe1clizcO2xzeE7Ha8TNDrD9TvLN/jQNlZvsPQH30Cbgh4ePuD7YGbaG7ETYXkMlzOd+ixeCjN8lotZSWy0yzHMs2UgBxykbwhgxeeNg9jPM8CzZ10VmWxKaa70iCTO/NuRpVcVYZ1bCk3zbb0b4rJdK5dM03RnJ4bIRsN6L2AF7FhIIcjX2X1B0NS7+so71+vmGHy9SKYKsmP+CJMHh5+XRa6ZC2Zk80Xlj8A3jBs836OGROp4dD/XKCRKAItJUCV87UzgPeqFPBWSKClCVLSINno1htI2MGU2ZN7PA/Cc4fbNx5+YygfgOP7PwY5YgYDArqaPbfpIT/9RrLOtUEzAkq8nLMN9z5f6qFPqcJSwiyyLctWz+R+e56nXgqzOhmLDdd+3qv/wZhCg7oJuT8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/a6db4db2a5edf34905c13b956a7b9ee9/c1b63/img_1.png\"\n        srcset=\"/static/a6db4db2a5edf34905c13b956a7b9ee9/5a46d/img_1.png 300w,\n/static/a6db4db2a5edf34905c13b956a7b9ee9/0a47e/img_1.png 600w,\n/static/a6db4db2a5edf34905c13b956a7b9ee9/c1b63/img_1.png 1200w,\n/static/a6db4db2a5edf34905c13b956a7b9ee9/50e7d/img_1.png 1738w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>실제로 객체의 연관관계를 나타낸 이미지와 DB 테이블의 다이어그램을 살펴보면 Group이 Member, Schedule, Participant와 연관관계를 맺고 있는 것을 확인할 수 있다.</p>\n<h1 id=\"개선-전-쿼리-분석\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%84%A0-%EC%A0%84-%EC%BF%BC%EB%A6%AC-%EB%B6%84%EC%84%9D\" aria-label=\"개선 전 쿼리 분석 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개선 전 쿼리 분석</h1>\n<p>서비스의 조회 쿼리를 개선하기 앞서 개선 전 조회 API별 쿼리를 먼저 분석해봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 482px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 129%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2ElEQVRIx52ViXbaQAxF/f+/15CSEDaDMXjDQLDNFlVXRtRpFtrOOcIGZiS9pydNUBS5vL29iS/e3Vin00k2ZSmbTSlFUehzI5fL5cNetyDPc8myzDa/vr7aRg74obqqZL1eS1mq6ZMA6koPXz53iKMsSyXPM9ntdu8is3a7rQyHLxJFkYxGQ8nSVI7Ho3y1gq/+cIccnoWhhNOJTCcTGY9HNySfZkgGhcLebjdmfOfA+Xy2Q5VCbhHkAt+Hw+FKyflGTdeCNE0sgyRZSRwvZLVaGqyWKzEagDyfzWwfxfH//gmyr6ZpZDYLZT6fKeSxPD8/2Xscx5Y5CZE91a/rWoJGP8gCaBg/Yg4Zh6XKhkqnmnlV7WW/35szpwln0HQ4NBIsl7GMtXrxYtFG1mcUze1PFgeAvFhEEs3ndrCr2/+CTCCcheHUpJOsVi3Ma+YgIBB778qmriuTyuTK30TfpyqhpXKIs/W6MNtut61DPjDkAJ+8U353yHe489Yrr07gGPuz4gHRiA4s4CBenPuCcKBiT0996xh45lw4ndqzaWpLwHR4DzLOJ+OxwTaoWsRvi9JtG4fa7WWiI2oqj8ORVpwMV8ul+GCBAqT3ZVG6Dr0oVmF1BkyEjg5pU9OhVvnmsO3dnf1ApRC1Z+vjK9csGF90RVvVdoxBx7HDt0GGZOAAgywYAF0OCeRFeXkZXDMdyuNjTwaDZ+n3H00Bt2lzDzIdQydhQGWAEIRsUQA8gpDp86EoXUe/OaxNVp7lQhF9O2A/c/i+KG2V0SldQl8zxghCtgRg5CF6hsZdHSIbDgOX8WV8qyMq6t0CLRSI94C2SpLE7hQ2+p3hDiu7pAqTRzsUMhvGnOMdBZxOx1sSAZt9SLYDM33Xn3ZJaXWB2u//NDXYVaESs5tQrds5f9V6wIRHioJDdAindAnZ8sRM2PeKwpzrPfwwDfZ6DzYgBjrGyNKnvHNIM/wCPcbTBq594j4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/69dc79c96485f21adea906e507fcf9b6/37e0d/img_2.png\"\n        srcset=\"/static/69dc79c96485f21adea906e507fcf9b6/5a46d/img_2.png 300w,\n/static/69dc79c96485f21adea906e507fcf9b6/37e0d/img_2.png 482w\"\n        sizes=\"(max-width: 482px) 100vw, 482px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>결과를 보면 알 수 있듯이 심각한 여러번 재귀적으로 발생하는 N+1문제는 아니지만 N+1문제가 존재하는 것과 불필요하게 많은 쿼리가 실행되는 것을 확인할 수 있었다. 지금부터 해당 쿼리를 어떠한 방식을 통해 개선하였는지 살펴보겠다.</p>\n<h1 id=\"fetchjoin을-통한-단건-조회-쿼리-개선\" style=\"position:relative;\"><a href=\"#fetchjoin%EC%9D%84-%ED%86%B5%ED%95%9C-%EB%8B%A8%EA%B1%B4-%EC%A1%B0%ED%9A%8C-%EC%BF%BC%EB%A6%AC-%EA%B0%9C%EC%84%A0\" aria-label=\"fetchjoin을 통한 단건 조회 쿼리 개선 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FetchJoin을 통한 단건 조회 쿼리 개선</h1>\n<p>모임 단건 조회의 경우, 모임의 상세 조회를 한 것이기에 다음과 같이 많은 데이터를 조회 후 반환하여야 했다. 단건 조회 요청에 대한 반환 값은 아래와 같다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"json\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;name&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;모모의 스터디&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;host&quot;</span><span class=\"mtk1\"> : {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;id&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">6</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;name&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;모모&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;categoryId&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;capacity&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">10</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;duration&quot;</span><span class=\"mtk1\"> : {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;start&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;2022-10-22&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;end&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;2022-10-22&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;schedules&quot;</span><span class=\"mtk1\"> : [ {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;date&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;2022-10-22&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;startTime&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;10:00:00&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;endTime&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;12:00:00&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;finished&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">false</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;deadline&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;2022-10-21T23:59&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;location&quot;</span><span class=\"mtk1\"> : {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;address&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;서울 송파구 올림픽로 289&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;buildingName&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;시그마타워&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;detail&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;1층&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;like&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">false</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;description&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>해당 데이터를 조회하기 위해서는 여러 테이블에 분산된 데이터를 조회하기 위해 아래와 같이 Group, Schedule, Member테이블을 각각 조회하여야 했다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"sql\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deadline</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deadline2_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">endDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> enddate3_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">startDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> startdat4_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">category</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> category5_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">closedEarly</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> closedea6_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">description</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> descript7_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationAddress</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location8_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationBuildingName</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location9_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationDetail</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> locatio10_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name11_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">capacity</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> capacit12_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> host_id13_1_0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_group group0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deleted</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deleted2_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">password</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> password3_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">user_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> user_id4_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name5_2_0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_member member0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> group_id5_4_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_4_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">date</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> date2_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">endTime</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> endtime3_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">startTime</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> starttim4_4_1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_schedule value0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span></code></pre>\n<p>해당 쿼리들은 엔티티들간의 연관관계 패치 타입을 <code>LAZY</code>가 아닌 <code>EAGER</code>로 설정하면 한 번의 쿼리로 조회를 할 수 있다. 하지만 패치 타입을 <code>EAGER</code>로 설정하게 된다면 우리가 예상하지 못한 쿼리들이 발생할 수 있기에 패치타입을 변경하는 방법이 아닌 fetch join을 하는 JPQL쿼리문을 작성하여 한 번의 쿼리로 모든 데이터를 조회하도록 하였다.</p>\n<p>작성한 쿼리는 아래와 같다. schedule, host의 정보를 fetch join을 통해 한번에 가져오는 쿼리를 만들어 한 번의 쿼리로 모든 데이터를 갖고 오도록 하였다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"java\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk1\">@</span><span class=\"mtk11\">Query</span><span class=\"mtk4\">(</span><span class=\"mtk6\">&quot;SELECT g FROM Group g &quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">            </span><span class=\"mtk8\">+</span><span class=\"mtk4\"> </span><span class=\"mtk6\">&quot;JOIN FETCH g.calendar.schedules.value &quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">            </span><span class=\"mtk8\">+</span><span class=\"mtk4\"> </span><span class=\"mtk6\">&quot;JOIN FETCH g.participants.host &quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">            </span><span class=\"mtk8\">+</span><span class=\"mtk4\"> </span><span class=\"mtk6\">&quot;WHERE g.id = :id&quot;</span><span class=\"mtk4\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk11\">Optional</span><span class=\"mtk8\">&lt;</span><span class=\"mtk4\">Group</span><span class=\"mtk8\">&gt;</span><span class=\"mtk4\"> </span><span class=\"mtk3\">findByIdWithHostAndSchedule</span><span class=\"mtk4\">(</span><span class=\"mtk11\">Long</span><span class=\"mtk4\"> id)</span><span class=\"mtk1\">;</span><span class=\"mtk4\"> </span></span></span></code></pre>\n<p>쿼리를 실행한 결과는 계획했던바와 같이 테이블별로 각각 조회하던 데이터를 join을 통해 한 번의 쿼리로 모든 데이터를 가져오도록 변경되었다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"sql\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_2_2_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deadline</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deadline2_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">endDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> enddate3_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">startDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> startdat4_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">category</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> category5_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">closedEarly</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> closedea6_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">description</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> descript7_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationAddress</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location8_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationBuildingName</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location9_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationDetail</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> locatio10_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name11_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">capacity</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> capacit12_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> host_id13_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">date</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> date2_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">endTime</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> endtime3_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">startTime</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> starttim4_4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> group_id5_4_0__,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_4_0__,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deleted</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deleted2_2_2_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">password</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> password3_2_2_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">user_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> user_id4_2_2_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name5_2_2_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_group group0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">inner join</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_schedule value1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9\">on</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk7\">value1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">inner join</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_member member2_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9\">on</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk8\">=</span><span class=\"mtk7\">member2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span></code></pre>\n<h1 id=\"dto를-통한-모임-목록-조회\" style=\"position:relative;\"><a href=\"#dto%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%AA%A8%EC%9E%84-%EB%AA%A9%EB%A1%9D-%EC%A1%B0%ED%9A%8C\" aria-label=\"dto를 통한 모임 목록 조회 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DTO를 통한 모임 목록 조회</h1>\n<p>모임 상세 조회를 제외한 모임 관련 조회 API는 모두 모임 목록 조회 API이다. 모모팀 서비스의 메인 페이지를 비롯해 여러 모임 목록 조회 페이지를 보면 아래와 같이 모임의 이름, 호스트, 마감일까지 남은 기간, 참여자 수, 최대 인원의 정보만을 출력하고 있는 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 861px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnUlEQVQoz31Su04CURDdX+MT9AdsiQmdjRY2NlbGisKEWkuMkQYCJoZKEk00KBQum10WZF1e+2SBPc4MuShEnWQyD2bPzLkHbTAYYDabrX25XCJNU3HOVc2Rbft3ZaqvBUGAJEkQhiGiKIKqOZ/P55LzIo6+70uM43ijx9+o5ZrneZhOpzBNE71eH7Ztg3uu60qu6zqYBc80m02JhmFgMplgPB6j3W7LTEpgvEAuDEO6ijbGcSSXKudL+EN1JQNwfzQaCQOu7Z5FgO8YUc61xvw/3SFMuw+L/GPgyFssFguhzM5gXP80nmEbB46A9qwuHGKiPb60sJs9xPFZASfnBezs5XBdKtMlPqxuF8PhcP0MCmjl36BiQShBe3h6xv7RKa5K97i4vEE2d4DibXmlnB+wfBtXbTtbFM/gRfFKZW60317RaDTQarVgdDorJUm9aOphSVSVgr85gyTJnOYDEUYAy5UKMpkMisUi6vW6DOqkpEt0f77Xv0ZiQV1Yq90hn8+jWq3CcRwBXNDfI/V8kBpI/6CrFoVE1wsjqb8AX6z1nqA47P8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/c6b97c820758295a8b5fe7a32a91b534/e35ec/img_3.png\"\n        srcset=\"/static/c6b97c820758295a8b5fe7a32a91b534/5a46d/img_3.png 300w,\n/static/c6b97c820758295a8b5fe7a32a91b534/0a47e/img_3.png 600w,\n/static/c6b97c820758295a8b5fe7a32a91b534/e35ec/img_3.png 861w\"\n        sizes=\"(max-width: 861px) 100vw, 861px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>즉, 사용자에게 정보를 보여주기 위해서는 모임 상세와 다르게 모임의 모든 정보가 아닌 일부의 데이터만을 필요로 하고 있다. 기존의 로직에서는 일부 데이터만을 필요로 하는 목록 조회에서도 전체 모임 정보를 읽어와 Group객체를 만들었다. 이러한 구조는 메모리와 DB 측면에서 성능 저하를 일으키고 있었다.</p>\n<h2 id=\"메모리-측면에서의-성능-저하\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%B8%A1%EB%A9%B4%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%B1%EB%8A%A5-%EC%A0%80%ED%95%98\" aria-label=\"메모리 측면에서의 성능 저하 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메모리 측면에서의 성능 저하</h2>\n<p>모모팀은 서비스를 개발하며 각각의 값들에 대한 안정성을 보장하기 위해 값 객체를 만들다보니 온전한 Group객체를 만들려면 수많은 객체들을 생성하여야 했다.</p>\n<p>모모팀 서비스의 Group 도메인 구조를 살펴보면 아래와 같이 수 많은 객체들이 엮여있는 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVQoz2VRW5KCMBDkOBIgQMIrUZSHAdzSqr3/ZXpnRnF3y48mydDpdM9ESZJAay3Isuy9Z+R5TjWN6+WIbflC2O4ojfng8ZnBWhF/0jRFQlBKYT+ntGZco7X3DdZwwzCMTy7VGMxnoTiOZeV/kSYXtqrkUJQlWufEGdfrpiUHOUxZ4DJM8MeTOGIxFrDWCsfa6lfwfPK4UZSm7eDaBvO8wHuP8dxjWx9w/oiTaxHChimsMCTCF8sixzwOmMn5dF3koafDVz/4BY7A9pWKobMUObnT2csRkdk575mzY+81g+9H6tWLvS/7kDrnKU5Djoy45GEU5IrrhvYSt67fA+qoVVVVP4eyI00THOjV3tW4P77RXyYSKUTQUJ8qU2AYr3J5oJbMUxBnxpRYlyD8f4L75CwNoescDauGkmgHqSuJe/hI9Bc/P2r8ibjYcpMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/7cdbbb60507b4b9bde355b692316c125/c1b63/img_4.png\"\n        srcset=\"/static/7cdbbb60507b4b9bde355b692316c125/5a46d/img_4.png 300w,\n/static/7cdbbb60507b4b9bde355b692316c125/0a47e/img_4.png 600w,\n/static/7cdbbb60507b4b9bde355b692316c125/c1b63/img_4.png 1200w,\n/static/7cdbbb60507b4b9bde355b692316c125/d61c2/img_4.png 1800w,\n/static/7cdbbb60507b4b9bde355b692316c125/e8950/img_4.png 2000w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>해당 클래스들을 단순 조회를 하였을 때 항상 만들어지는 객체와 Proxy로 만들어지는 객체를 정리해보면 다음과 같다.</p>\n<ul>\n<li>항상 만들어지는 객체: Group, GroupName, Location, Description, Calender, Deadline, Duration, Participants, Capacity</li>\n<li>지연로딩으로 만들어지는 Proxy객체: Schedule, Participant</li>\n</ul>\n<p>Group객체를 만들 때는 <code>9 + (N개의 Schedule Proxy객체) + (N개의 Participant객체)</code> 가 만들어지고 있었다. 우리 서비스의 타겟 인원(150명)이 동시에 모임 목록 조회 요청을 보냈을 때를 생각해보겠다. 모모 서비스는 목록 조회시 페이지네이션의 적용으로 인해 12개의 모임을 조회 및 반환하고 있다. 12개의 모임 조회를 150명이 동시에 요청을 한다면 요청을 처리하기 위해 만들어져야하는 도메인 레이어의 객체의 수는 <code>{9 + (N개의 Schedule Proxy객체) + (N개의 Participant객체)} * 12 * 150</code> 개가 된다. 이는 많은 메모리를 사용할 것이고 GC가 해야할 일이 너무 많아질 것이다.</p>\n<blockquote>\n<p>실제 요청을 처리하기 위해서는 Request, Response DTO, Participant의 실제 객체를 만드는 등의 추가적인 객체들이 만들어져야합니다.</p>\n</blockquote>\n<p>우리의 타겟 인원 150명만을 생각해도 셀 수도 없이 많은 객체들이 만들어지는데, 우리의 서비스가 배민과 같이 초당 요청이 수 십, 수 백만 건의 모임 목록 조회 요청을 받게 된다고 생각하면 진짜 상상할 수도 없을 정도의 객체들이 만들어질 것이다.</p>\n<p>즉, 값 객체를 만들어 애플리케이션의 안정성은 높일 수 있었으나 메모리 측면의 성능에서는 확실히 많은 손해를 보고 있던 것이다.</p>\n<h2 id=\"db-측면에서의-성능-저하\" style=\"position:relative;\"><a href=\"#db-%EC%B8%A1%EB%A9%B4%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%B1%EB%8A%A5-%EC%A0%80%ED%95%98\" aria-label=\"db 측면에서의 성능 저하 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 측면에서의 성능 저하</h2>\n<h3 id=\"불필요한-데이터-요청\" style=\"position:relative;\"><a href=\"#%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9A%94%EC%B2%AD\" aria-label=\"불필요한 데이터 요청 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>불필요한 데이터 요청</h3>\n<p>실제 사용되지 않는 모든 데이터를 조회하는 것은 DB와의 통신 측면에서도 좋지 않다. Spring 애플리케이션과 DB는 서로 다른 인스턴스에 위치해있고 둘 사이에서도 필요한 데이터를 가져오기 위해 요청과 응답 과정을 거치며 네트워크 통신을 하게 된다. 둘 사이에 통신을 할 때 불필요한 데이터들도 조회 및 전송을 한다면 해당 부분에서도 확실히 성능 저하가 발생할 것이다.</p>\n<h3 id=\"보내지는-쿼리의-수\" style=\"position:relative;\"><a href=\"#%EB%B3%B4%EB%82%B4%EC%A7%80%EB%8A%94-%EC%BF%BC%EB%A6%AC%EC%9D%98-%EC%88%98\" aria-label=\"보내지는 쿼리의 수 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>보내지는 쿼리의 수</h3>\n<p>성능 개선 전 모임 목록 조회를 하였을 경우 DB에 <code>모임조회 쿼리1 + (호스트 조회 쿼리 1 + 각각 모임의 참여자 확인을 위한 쿼리 N) * 모임 수</code> 개의 쿼리가 날라갔다. 여기서 모임 참여자 확인을 위한 쿼리는 모임을 참여하는 인원 수를 비즈니스 로직에서 확인을 하다보니 Group이 갖고 있는 지연 로딩으로 인해 Proxy객체로 조회되었던 <code>List&#x3C;Participant></code>의 데이터를 하나씩 조회하는 과정에서 실행이 되었다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"sql\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">distinct</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deadline</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deadline2_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">endDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> enddate3_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">startDate</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> startdat4_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">category</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> category5_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">closedEarly</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> closedea6_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">description</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> descript7_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationAddress</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location8_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationBuildingName</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> location9_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">locationDetail</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> locatio10_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name11_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">capacity</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> capacit12_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> host_id13_1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_group group0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">left outer join</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_participant participan1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9\">on</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk7\">participan1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">order by</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">desc</span><span class=\"mtk1\"> </span><span class=\"mtk9\">limit</span><span class=\"mtk1\"> ?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deleted</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> deleted2_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">password</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> password3_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">user_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> user_id4_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> name5_2_0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_member member0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> group_id2_3_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_3_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> id1_3_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> group_id2_3_1_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">member_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> member_i3_3_1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_participant participan0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">where</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">participan0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk8\">=</span><span class=\"mtk1\">?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(참여자 수 N만큼 참여자 조회 쿼리가 날라간다.)</span></span></span></code></pre>\n<p>즉, 하나의 모임 데이터를 조회하는 것만 생각하여도 Group테이블에 대한 조회뿐만 아니라 Member테이블에 1번, Participant 테이블에 N번 조회하여 셀 수 없이 많은 쿼리들이 실행되고 있었다. 이 또한 DB Connection을 그만큼 오래 잡고 많은 요청을 하기에 성능상의 저하를 유발시켰다.</p>\n<h2 id=\"문제-해결\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"문제 해결 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 해결</h2>\n<p>해당 문제들은 모임 목록 조회를 할 때, Repository레이어에서 DTO를 반환하도록 로직을 수정하며 해결하였다. 코드를 살펴보겠다. 기존의 모임 목록 조회 로직은 QueryDsl의 로직을 통해 처리되었었다</p>\n<blockquote>\n<p>QueryDsl을 통해 모임 목록을 조회한 이유는 모임 목록 조회시 카테고리별 조회, 마감된 모임 목록 조회, 키워드를 통한 조회 등의 여러 검색 조건을 걸 수 있어 동적 쿼리를 만들기 위해 사용하였다.</p>\n</blockquote>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"java\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk11\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">public</span><span class=\"mtk4\"> </span><span class=\"mtk9\">class</span><span class=\"mtk4\"> </span><span class=\"mtk11\">GroupSearchRepositoryImpl</span><span class=\"mtk4\"> </span><span class=\"mtk9\">implements</span><span class=\"mtk4\"> </span><span class=\"mtk11\">GroupSearchRepositoryCustom</span><span class=\"mtk4\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">\t</span><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">\t</span><span class=\"mtk9\">private</span><span class=\"mtk3\"> </span><span class=\"mtk11\">Page</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">Group</span><span class=\"mtk1\">&gt;</span><span class=\"mtk3\"> findGroups</span><span class=\"mtk1\">(</span><span class=\"mtk11\">SearchCondition</span><span class=\"mtk1\"> </span><span class=\"mtk4 mtki\">condition</span><span class=\"mtk1\">, </span><span class=\"mtk11\">Pageable</span><span class=\"mtk1\"> </span><span class=\"mtk4 mtki\">pageable</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                   </span><span class=\"mtk11\">Supplier</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">BooleanExpression</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4 mtki\">mainCondition</span><span class=\"mtk1\">)</span><span class=\"mtk3\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">Group</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4\">groups</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> queryFactory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">select</span><span class=\"mtk1\">(group).</span><span class=\"mtk3\">distinct</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">from</span><span class=\"mtk1\">(group)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">leftJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk4\">participants</span><span class=\"mtk1\">, participant)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">where</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">mainCondition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">conditionFilter</span><span class=\"mtk1\">.</span><span class=\"mtk3\">filterByCondition</span><span class=\"mtk1\">(condition)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">orderBy</span><span class=\"mtk1\">(</span><span class=\"mtk3\">orderByDeadlineAsc</span><span class=\"mtk1\">(</span><span class=\"mtk11\">condition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">orderByDeadline</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">toArray</span><span class=\"mtk1\">(</span><span class=\"mtk11\">OrderSpecifier</span><span class=\"mtk1\">[]</span><span class=\"mtk9\">::new</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">offset</span><span class=\"mtk1\">(</span><span class=\"mtk11\">pageable</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getOffset</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">limit</span><span class=\"mtk1\">(</span><span class=\"mtk11\">pageable</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getPageSize</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">fetch</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">JPAQuery</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">Long</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4\">countQuery</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> queryFactory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">select</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk3\">countDistinct</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">from</span><span class=\"mtk1\">(group)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">leftJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk4\">participants</span><span class=\"mtk1\">, participant)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">where</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">mainCondition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">conditionFilter</span><span class=\"mtk1\">.</span><span class=\"mtk3\">filterByCondition</span><span class=\"mtk1\">(condition)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PageableExecutionUtils</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getPage</span><span class=\"mtk1\">(groups, pageable, countQuery</span><span class=\"mtk9\">::</span><span class=\"mtk1\">fetchOne);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>코드를 보면 요청에 대한 반환값이 Group인 것을 확인할 수 있다. 이제 Group전체 데이터가 아닌 필요한 데이터만을 조회하도록 코드를 변경해보겠다. 모임 목록 조회 API 호출시 반환값은 아래와 같다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"json\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;hasNextPage&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">false</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;pageNumber&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">0</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">&quot;groups&quot;</span><span class=\"mtk1\"> : [ {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;id&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">46</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;name&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;모모의 리엑트 스터디&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;host&quot;</span><span class=\"mtk1\"> : {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">&quot;id&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">12</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">&quot;name&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;모모&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;categoryId&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;capacity&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">10</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;numOfParticipant&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;finished&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">false</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;deadline&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk6\">&quot;2022-10-21T23:59&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">&quot;like&quot;</span><span class=\"mtk1\"> : </span><span class=\"mtk7\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  } ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>여기서 필요한 데이터만을 추출하여 데이터를 담아올 <code>GroupSummaryRepositoryResponse</code> DTO를 먼저 만들어보겠다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"java\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk11\">Getter</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk11\">AllArgsConstructor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">public</span><span class=\"mtk4\"> </span><span class=\"mtk9\">class</span><span class=\"mtk4\"> </span><span class=\"mtk11\">GroupSummaryRepositoryResponse</span><span class=\"mtk4\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">Long</span><span class=\"mtk4\"> groupId</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">String</span><span class=\"mtk4\"> groupName</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">Long</span><span class=\"mtk4\"> hostId</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">String</span><span class=\"mtk4\"> hostName</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">Category</span><span class=\"mtk4\"> category</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk9\">int</span><span class=\"mtk4\"> capacity</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk9\">int</span><span class=\"mtk4\"> numOfParticipant</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk9\">boolean</span><span class=\"mtk4\"> isClosedEarly</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk4\"> </span><span class=\"mtk11\">LocalDateTime</span><span class=\"mtk4\"> deadline</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>해당 DTO를 바로 반환하도록 로직을 수정해보겠다. DTO반환의 경우 QueryDsl의 select문에 DTO생성에 대한 코드를 작성해야하지만 코드의 가독성 향상을 위해 <code>makeProjections()</code> 메서드로 분리하였다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"java\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk11\">Repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">public</span><span class=\"mtk4\"> </span><span class=\"mtk9\">class</span><span class=\"mtk4\"> </span><span class=\"mtk11\">GroupSearchRepositoryImpl</span><span class=\"mtk4\"> </span><span class=\"mtk9\">implements</span><span class=\"mtk4\"> </span><span class=\"mtk11\">GroupSearchRepositoryCustom</span><span class=\"mtk4\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">\t</span><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">\t</span><span class=\"mtk9\">private</span><span class=\"mtk3\"> </span><span class=\"mtk11\">Page</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GroupSummaryRepositoryResponse</span><span class=\"mtk1\">&gt;</span><span class=\"mtk3\"> findGroups</span><span class=\"mtk1\">(</span><span class=\"mtk11\">SearchCondition</span><span class=\"mtk1\"> </span><span class=\"mtk4 mtki\">condition</span><span class=\"mtk1\">, </span><span class=\"mtk11\">Pageable</span><span class=\"mtk1\"> </span><span class=\"mtk4 mtki\">pageable</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                                            </span><span class=\"mtk11\">Supplier</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">BooleanExpression</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4 mtki\">mainCondition</span><span class=\"mtk1\">)</span><span class=\"mtk3\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">List</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GroupSummaryRepositoryResponse</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4\">groups</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> queryFactory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">select</span><span class=\"mtk1\">(</span><span class=\"mtk3\">makeProjections</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">from</span><span class=\"mtk1\">(group)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">innerJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk4\">host</span><span class=\"mtk1\">, member)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">leftJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk4\">participants</span><span class=\"mtk1\">, participant)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">where</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">mainCondition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">conditionFilter</span><span class=\"mtk1\">.</span><span class=\"mtk3\">filterByCondition</span><span class=\"mtk1\">(condition)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">groupBy</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">orderBy</span><span class=\"mtk1\">(</span><span class=\"mtk3\">orderByDeadlineAsc</span><span class=\"mtk1\">(</span><span class=\"mtk11\">condition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">orderByDeadline</span><span class=\"mtk1\">()).</span><span class=\"mtk3\">toArray</span><span class=\"mtk1\">(</span><span class=\"mtk11\">OrderSpecifier</span><span class=\"mtk1\">[]</span><span class=\"mtk9\">::new</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">offset</span><span class=\"mtk1\">(</span><span class=\"mtk11\">pageable</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getOffset</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">limit</span><span class=\"mtk1\">(</span><span class=\"mtk11\">pageable</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getPageSize</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">fetch</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk11\">JPAQuery</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">Long</span><span class=\"mtk1\">&gt; </span><span class=\"mtk4\">countQuery</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> queryFactory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">select</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk3\">countDistinct</span><span class=\"mtk1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">from</span><span class=\"mtk1\">(group)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">leftJoin</span><span class=\"mtk1\">(</span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk4\">participants</span><span class=\"mtk1\">, participant)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                .</span><span class=\"mtk3\">where</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">mainCondition</span><span class=\"mtk1\">.</span><span class=\"mtk3\">get</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                        </span><span class=\"mtk11\">conditionFilter</span><span class=\"mtk1\">.</span><span class=\"mtk3\">filterByCondition</span><span class=\"mtk1\">(condition)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">PageableExecutionUtils</span><span class=\"mtk1\">.</span><span class=\"mtk3\">getPage</span><span class=\"mtk1\">(groups, pageable, countQuery</span><span class=\"mtk9\">::</span><span class=\"mtk1\">fetchOne);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">    </span><span class=\"mtk9\">private</span><span class=\"mtk3\"> </span><span class=\"mtk9\">static</span><span class=\"mtk3\"> </span><span class=\"mtk11\">ConstructorExpression</span><span class=\"mtk1\">&lt;</span><span class=\"mtk11\">GroupSummaryRepositoryResponse</span><span class=\"mtk1\">&gt;</span><span class=\"mtk3\"> makeProjections</span><span class=\"mtk1\">()</span><span class=\"mtk3\"> </span><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">int</span><span class=\"mtk1\"> </span><span class=\"mtk4\">host</span><span class=\"mtk1\"> </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk11\">Projections</span><span class=\"mtk1\">.</span><span class=\"mtk3\">constructor</span><span class=\"mtk1\">(</span><span class=\"mtk11\">GroupSummaryRepositoryResponse</span><span class=\"mtk1\">.</span><span class=\"mtk4\">class</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">name</span><span class=\"mtk1\">.</span><span class=\"mtk4\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk11\">host</span><span class=\"mtk1\">.</span><span class=\"mtk4\">id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">member</span><span class=\"mtk1\">.</span><span class=\"mtk11\">userName</span><span class=\"mtk1\">.</span><span class=\"mtk4\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk4\">category</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">participants</span><span class=\"mtk1\">.</span><span class=\"mtk11\">capacity</span><span class=\"mtk1\">.</span><span class=\"mtk4\">value</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">participant</span><span class=\"mtk1\">.</span><span class=\"mtk3\">count</span><span class=\"mtk1\">().</span><span class=\"mtk3\">intValue</span><span class=\"mtk1\">().</span><span class=\"mtk3\">add</span><span class=\"mtk1\">(host),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk4\">closedEarly</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk11\">group</span><span class=\"mtk1\">.</span><span class=\"mtk11\">calendar</span><span class=\"mtk1\">.</span><span class=\"mtk11\">deadline</span><span class=\"mtk1\">.</span><span class=\"mtk4\">value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span></code></pre>\n<p>변경된 코드는 이게 전부이다.</p>\n<p>이제 실제 요청을 보내 변경된 쿼리를 살펴보겠다. 앞서 개선전 요청을 처리하기 위해서는 <code>모임조회 쿼리1 + (호스트 조회 쿼리 1 + 각각 모임의 참여자 확인을 위한 쿼리 N) * 모임 수</code> 개의 쿼리가 실행되었다. 하지만 개선 후의 쿼리 실행 결과를 보면 아래의 쿼리 한개만 실행된다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"sql\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Hibernate: </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">select</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_0_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_1_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_2_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">member1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">name</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_3_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">category</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_4_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">capacity</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_5_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">cast</span><span class=\"mtk1\">(</span><span class=\"mtk8\">count</span><span class=\"mtk1\">(</span><span class=\"mtk7\">participan2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\">) </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> </span><span class=\"mtk9\">integer</span><span class=\"mtk1\">)+? </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_6_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">closedEarly</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_7_0_,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">deadline</span><span class=\"mtk1\"> </span><span class=\"mtk9\">as</span><span class=\"mtk1\"> col_8_0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_group group0_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">inner join</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_member member1_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9\">on</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">host_id</span><span class=\"mtk8\">=</span><span class=\"mtk7\">member1_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">left outer join</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        momo_participant participan2_ </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9\">on</span><span class=\"mtk1\"> </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk8\">=</span><span class=\"mtk7\">participan2_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">group_id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">group by</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">order by</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">group0_</span><span class=\"mtk1\">.</span><span class=\"mtk7\">id</span><span class=\"mtk1\"> </span><span class=\"mtk9\">desc</span><span class=\"mtk1\"> </span><span class=\"mtk9\">limit</span><span class=\"mtk1\"> ?</span></span></span></code></pre>\n<blockquote>\n<p>참여한 목록, 찜한 목록, 주최한 목록 조회의 경우 기본 모임 목록 조회와 사용하는 베이스 메서드가 같아서 포스트에 따로 남기지는 않겠다.</p>\n</blockquote>\n<h1 id=\"개선-전후-실행되는-쿼리-수-비교\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%84%A0-%EC%A0%84%ED%9B%84-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94-%EC%BF%BC%EB%A6%AC-%EC%88%98-%EB%B9%84%EA%B5%90\" aria-label=\"개선 전후 실행되는 쿼리 수 비교 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개선 전/후 실행되는 쿼리 수 비교</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 732px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQ4y3WUC3OiQBCE+f+/L8bTi4IaBUR5yEvwMbffkOEklWzVFNSyM9M93YuXZZlUVSW3202ez6dG13WS55lcikLu9/u4T7C67iplWUrbNpM8wqvrSi6Xiyba4nDg+7JeryRNU917Ldj3vXt/jOcnBenSNI3Uda1PNq/XVsIwlCRJdO/7AtWA/CGPx2NaEHRFkTuUhVJnVQ7hbrfVyLLUNbjqGEBGAX2+MHpdHvMggUN932mXtm3leIwlikJJz2ctykwLN1MQW1HOEY1jB1NQe4iSpi4pJSnXLsz1sN9L5GjzTgELZeCY+P5aI0mOmkcwCu8n2Mxzv/+UzSaQ7XajDYekTBEODI5ydugZ2YSy0TmfT0qdRRJ0w/AgcRwpZeiCwFSGZlle1BH/EfaDbUBUVeWYYJQ+/i61GN8JsxYizuczWSz+aOPanW+a4fuvlDdBIKvVhxamKCaHiRWGNoKi/oQy3UxBQwBlqNLdKGMrKI2Um1rpwowaNhKPTQbL01TkcBD4ig6l8ePnbjcKQBFuEd8RzzzL/oSyXS08hSBYh0N2C6whc0f9w2Ev2M7ylPLPM6zUMqAgTqdEEweBBl8yHsKEHAsyvzwbbNN92QaE3JQ4jnXfrqUhRAhGxNxgMDG2WYID1o335XIh77M3nRHiMEsKIAgizNy3+fxdaQ+2aX63DQaPokgRUgyRQMW+/WnsZ/HdNv8ANmEhHZvt+fUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/c8b270b70ec317afc6e5f4d73d2aedd9/d0cc0/img_5.png\"\n        srcset=\"/static/c8b270b70ec317afc6e5f4d73d2aedd9/5a46d/img_5.png 300w,\n/static/c8b270b70ec317afc6e5f4d73d2aedd9/0a47e/img_5.png 600w,\n/static/c8b270b70ec317afc6e5f4d73d2aedd9/d0cc0/img_5.png 732w\"\n        sizes=\"(max-width: 732px) 100vw, 732px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h1 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h1>\n<p>이번 포스트에서는 모모팀 서비스의 조회로직 관련 쿼리 개선기에 대해 다뤄봤다. JPA공부를 시작하고 영한님의 인프런 강의를 수강하며 성능 개선에 대한 이야기를 들을 때마다 모모팀의 서비스도 전반적으로 둘러보며 성능 개선을 해야겠다는 생각을 줄곧 해왔지만 서비스 개발하는데 급급하여 성능 개선은 미뤄오기만 했었다. 미뤄왔던 조회 성능 개선을 진행하며 우리 서비스의 성능상의 많은 문제점들을 발견하고 개선해보는 시간을 가져봤다.</p>\n<p>개선을 진행하며 확실히 애플리케이션 개발 중간중간 이와 같이 쿼리를 확인하는 시간을 가져봐야한다는 필요성을 느끼었고 JPA의 동작과정에 대해 다시 한번 학습해보는 좋은 시간을 가지며 한 단계 더 성장한 것 같다 뿌듯함을 느끼었다.</p>\n<p>지금까지 조회 관련 성능 개선을 완료하였으니 이제 내일부터는 CUD관련 쿼리를 분석 및 개선해보는 시간을 가져보려한다.</p>\n<blockquote>\n<p>코드 변경에 대한 자세한 내용은 아래의 PR과 모모 레포지토리를 통해 확인하실 수 있습니다.\n코드 변경에 대한 자세한 내용은 아래의 PR과 모모 레포지토리를 통해 확인하실 수 있습니다.</p>\n<ul>\n<li><a href=\"https://github.com/woowacourse-teams/2022-momo\">woowacourse-teams/2022-momo</a></li>\n<li><a href=\"https://github.com/woowacourse-teams/2022-momo/pull/441\">woowacourse-teams/2022-momo/pull/441</a></li>\n</ul>\n</blockquote>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .one-dark-pro {\n    background-color: #282c34;\n    color: #abb2bf;\n  }\n  .one-dark-pro .mtki { font-style: italic; }\n  .one-dark-pro .mtk1 { color: #ABB2BF; }\n  .one-dark-pro .mtk4 { color: #E06C75; }\n  .one-dark-pro .mtk6 { color: #98C379; }\n  .one-dark-pro .mtk7 { color: #D19A66; }\n  .one-dark-pro .mtk9 { color: #C678DD; }\n  .one-dark-pro .mtk8 { color: #56B6C2; }\n  .one-dark-pro .mtk11 { color: #E5C07B; }\n  .one-dark-pro .mtk3 { color: #61AFEF; }\n  .one-dark-pro .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0\">들어가며</a></li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EA%B0%9D%EC%B2%B4-%EB%B0%8F-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84\">객체 및 테이블의 연관관계</a></li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EA%B0%9C%EC%84%A0-%EC%A0%84-%EC%BF%BC%EB%A6%AC-%EB%B6%84%EC%84%9D\">개선 전 쿼리 분석</a></li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#fetchjoin%EC%9D%84-%ED%86%B5%ED%95%9C-%EB%8B%A8%EA%B1%B4-%EC%A1%B0%ED%9A%8C-%EC%BF%BC%EB%A6%AC-%EA%B0%9C%EC%84%A0\">FetchJoin을 통한 단건 조회 쿼리 개선</a></li>\n<li>\n<p><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#dto%EB%A5%BC-%ED%86%B5%ED%95%9C-%EB%AA%A8%EC%9E%84-%EB%AA%A9%EB%A1%9D-%EC%A1%B0%ED%9A%8C\">DTO를 통한 모임 목록 조회</a></p>\n<ul>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%B8%A1%EB%A9%B4%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%B1%EB%8A%A5-%EC%A0%80%ED%95%98\">메모리 측면에서의 성능 저하</a></li>\n<li>\n<p><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#db-%EC%B8%A1%EB%A9%B4%EC%97%90%EC%84%9C%EC%9D%98-%EC%84%B1%EB%8A%A5-%EC%A0%80%ED%95%98\">DB 측면에서의 성능 저하</a></p>\n<ul>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9A%94%EC%B2%AD\">불필요한 데이터 요청</a></li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%B3%B4%EB%82%B4%EC%A7%80%EB%8A%94-%EC%BF%BC%EB%A6%AC%EC%9D%98-%EC%88%98\">보내지는 쿼리의 수</a></li>\n</ul>\n</li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\">문제 해결</a></li>\n</ul>\n</li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EA%B0%9C%EC%84%A0-%EC%A0%84%ED%9B%84-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94-%EC%BF%BC%EB%A6%AC-%EC%88%98-%EB%B9%84%EA%B5%90\">개선 전/후 실행되는 쿼리 수 비교</a></li>\n<li><a href=\"/Backend/20221014-%EB%AA%A8%EB%AA%A8%ED%8C%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B02/#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>","frontmatter":{"date":"2022년 10월 14일","title":"모모팀 서비스 성능 개선기2 (조회 쿼리 개선)","tags":["SpringFramework","성능 개선기","조회 쿼리 개선","fetch join","DTO반환"]}}},"pageContext":{"slug":"/Backend/20221014-모모팀-서비스성능-개선기2/","previous":{"fields":{"slug":"/Backend/20221009-모모팀-서비스성능-개선기1/"},"frontmatter":{"title":"모모팀 서비스 성능 개선기1 (의존관계 개선)"}},"next":{"fields":{"slug":"/Backend/20221017-모모팀-서비스성능-개선기3/"},"frontmatter":{"title":"모모팀 서비스 성능 개선기3 (CUD 쿼리 개선)"}}}},"staticQueryHashes":["3911196313","4111100897"]}